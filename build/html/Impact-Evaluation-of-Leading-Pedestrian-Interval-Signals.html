

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>An Evaluation of the Impact of Leading Pedestrian Interval Signals in NYC &mdash; LPIS Evaluation 1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stata Analysis of NYC Leading Pedestrian Interval Signal (LPIs)" href="stata_analysis_qt_panel.html" />
    <link rel="prev" title="Jeremy J. Sze’s Masters Thesis Documentation" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> LPIS Evaluation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">An Evaluation of the Impact of Leading Pedestrian Interval Signals in NYC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Acknowledgements">Acknowledgements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Contents">Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Signal-intersection">1. Signal intersection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#About-“signal_controllers.csv”">About “signal_controllers.csv”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Leading-Pedestrian-Interval-Signals-(LPIs)">2. Leading Pedestrian Interval Signals (LPIs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Linking-Signal-intersection-to-other-data">3. Linking Signal intersection to other data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#3.a.-Signal-Intersections">3.a. Signal Intersections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.b.-Leading-Pedestrian-Signal-Interval">3.b. Leading Pedestrian Signal Interval</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.c.-School-shapefile">3.c. School shapefile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.d.-Vision-Zero-Left-Turn-Calming-intervention">3.d. Vision Zero Left Turn Calming intervention</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.e.-Vision-Zero-Street-Improvement">3.e. Vision Zero Street Improvement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.f.-Bike-Routes">3.f. Bike Routes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.g.-Borough">3.g. Borough</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.h.-Priority-Intersections">3.h. Priority Intersections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.i.-Safe-Streets-for-Seniors">3.i. Safe Streets for Seniors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-NYPD-Motor-Vehicle-Collision-data">4. NYPD Motor Vehicle Collision data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#4.a.-download">4.a. download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.b.-clean">4.b. clean</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.c.-link-to-signal-intersection">4.c. link to signal intersection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Calculate-collision-outcomes">5. Calculate collision outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#6.-Set-up-Quarterly-Panel-data">6. Set up Quarterly Panel data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#6.a.-Merge-in-Intersection-Data">6.a. Merge in Intersection Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.b.-Create-borough-dummies">6.b. Create borough dummies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.c.-Nearest-Bike-Route">6.c. Nearest Bike Route</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Determine-if-collision-occured-on-bike-route">Determine if collision occured on bike route</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#6.d.-Left-Turn-Calming-Intervention">6.d. Left Turn Calming Intervention</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Matching-intersection-to-closest-left-turn-calming-intervention">Matching intersection to closest left turn calming intervention</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#6.e.-Street-Improvement-Project-intervention">6.e. Street Improvement Project intervention</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Matching-intersection-to-closest-street-improvement-project">Matching intersection to closest street improvement project</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#6.f.-Leading-Pedestrian-Interval-Signal">6.f. Leading Pedestrian Interval Signal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Matching-intersection-to-closest-leading-pedestrian-interval-signal">Matching intersection to closest leading pedestrian interval signal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Problem:-Certain-LPIs-intersections-had-been-install-before-collision-data">Problem: Certain LPIs intersections had been install before collision data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#6.g.-Safe-Streets-for-Seniors">6.g. Safe Streets for Seniors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.h.-Priority-Intersection">6.h. Priority Intersection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.i.-School-intersection/crossing">6.i. School intersection/crossing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.j.-Decay-effect">6.j. Decay effect</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.k.-Panel-is-strongly-balanced">6.k. Panel is strongly balanced</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.l.-Merge-outcomes-data">6.l. Merge outcomes data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#6.m.-Fill-in-missing-information">6.m. Fill in missing information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#7.-Convert-analytical-panel-data-into-shapefile">7. Convert analytical panel data into shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#8.-Thiessen-Polygons">8. Thiessen Polygons</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#8.a.-Voronoi">8.a. Voronoi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#8.b.-Spatial-Autocorrelation">8.b. Spatial Autocorrelation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="stata_analysis_qt_panel.html">Stata Analysis of NYC Leading Pedestrian Interval Signal (LPIs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stata_spatial_regression_qt.html">Calculate Contiguity and Inverse Distance matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="stata_spatial_regression_qt.html#Use-saved-matrix">Use saved matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="stata_spatial_regression_qt.html#Non-spatial-Models">Non-spatial Models</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LPIS Evaluation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>An Evaluation of the Impact of Leading Pedestrian Interval Signals in NYC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="An-Evaluation-of-the-Impact-of-Leading-Pedestrian-Interval-Signals-in-NYC">
<h1>An Evaluation of the Impact of Leading Pedestrian Interval Signals in NYC<a class="headerlink" href="#An-Evaluation-of-the-Impact-of-Leading-Pedestrian-Interval-Signals-in-NYC" title="Permalink to this headline">¶</a></h1>
<p>By Jeremy J. Sze</p>
<p>Submitted in partial fulfillment of the requirements for the degree of Master of Arts in Economics, Hunter College The City University of New York 2019</p>
<div class="line-block">
<div class="line">Thesis Sponsor: Professor Jonathan Conning</div>
<div class="line">Professor Partha Deb</div>
</div>
<p>Link to thesis: <a class="reference external" href="https://academicworks.cuny.edu/hc_sas_etds/432/">https://academicworks.cuny.edu/hc_sas_etds/432/</a></p>
<div class="section" id="Abstract">
<h2>Abstract<a class="headerlink" href="#Abstract" title="Permalink to this headline">¶</a></h2>
<p style="text-align: justify;"><p>I evaluated the impact of the phased introduction of Leading Pedestrian Interval Signals (LPIs) on collision and injury outcomes at 12,987 signalized traffic intersections in New York City over the course of 25 quarters from 2012 to 2018. An intersection is treated when a LPIs is installed to give pedestrians lead time to cross the street before vehicles are allowed to move. Outcomes from NYPD’s Motor Vehicle Collisions data were matched to signalized intersections. I hypothesize that LPIs would
reduce collisions and reduce injuries for pedestrians at intersections. A difference in difference fixed effects panel regression was used to identify the causal effect of introducing LPIs. This approach accounts for the problem that unobserved heterogeneity that might bias results in simpler regression approaches. The analysis suggests that the introduction of LPIs decreased quarterly collision counts by 5.45% and decreased the quarterly number of pedestrians injured by 14.7% over the same
intervention period. LPIs appears to be effective in reducing both collisions and injuries.</p>
</p></div>
<div class="section" id="Acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#Acknowledgements" title="Permalink to this headline">¶</a></h2>
<p style="text-align: justify;"><p>Throughout the analysis and writing of my thesis I had received a great deal of support and assistance. I would like to thank my thesis advisor, Professor Jonathan Conning, who helped me develop my data processing pipeline and analytical plan. Next, I would like to thank Professor Partha Deb and Professor Matthew Baker for their valuable time and input during the model development stage and Professor Randall Filer for his guidance in the bi-weekly thesis workshops. In addition, I would like to
thank my sister, Jocelyne Sze and friend Dennis Kim for proofreading my thesis drafts. Finally, I would like to thank my wife, Maria Eugenia Brandão for her wise counsel and support as we discussed ideas for my thesis.</p>
</p></div>
<div class="section" id="Contents">
<h2>Contents<a class="headerlink" href="#Contents" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Signal intersection (stata)</p></li>
<li><p>LPIs (python)</p></li>
<li><p>Linking Signal intersection to other data (python)</p></li>
<li><p>NYPD Motor Vehicle Collision data</p>
<ul class="simple">
<li><p>download (stata)</p></li>
<li><p>clean (stata)</p></li>
<li><p>link to signal intersection (python)</p></li>
</ul>
</li>
<li><p>Calculate collision outcomes (stata)</p></li>
<li><p>Set up panel data</p>
<ul class="simple">
<li><p>monthly analytical panel (stata)</p></li>
<li><p>quarterly analytical panel (stata)</p></li>
</ul>
</li>
<li><p>Convert analytical panel data into shapefile (python)</p></li>
<li><p>Thiessen Polygons (python)</p></li>
<li><p>Non-spatial Analysis (stata)</p></li>
<li><p>Spatial Analysis (stata)</p></li>
</ol>
</div>
<div class="section" id="1.-Signal-intersection">
<h2>1. Signal intersection<a class="headerlink" href="#1.-Signal-intersection" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Stata</p></li>
<li><p>Explore duplicates</p></li>
<li><p>Create intersection IDS</p></li>
</ul>
<div class="section" id="About-“signal_controllers.csv”">
<h3>About “signal_controllers.csv”<a class="headerlink" href="#About-“signal_controllers.csv”" title="Permalink to this headline">¶</a></h3>
<p>This was obtained through a request to the DOT Commissioner.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>cd &quot;..\input_data\DOT_traffic_signals_Oct_2018\&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C:\Users\jerem\Box Sync\Policy Evaluation\input_data\DOT_traffic_signals_Oct_2018
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>import delimited using &quot;signal_controllers.csv&quot;,clear stringcols(_all)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(6 vars, 13,278 obs)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>describe
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Contains data
  obs:        13,278
 vars:             7
 size:     2,376,762
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
y               str22   %22s                  Y
x               str22   %22s                  X
st1_name        str31   %31s                  ST1_Name
st2_name        str32   %32s                  ST2_Name
st3_name        str35   %35s                  ST3_Name
st4_name        str36   %36s                  ST4_Name
dup             byte    %12.0g
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by:
     Note: Dataset has changed since last saved.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>duplicates tag y x, gen(dup)
tab dup
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


Duplicates in terms of y x


        dup |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     13,156       99.08       99.08
          1 |        112        0.84       99.92
          2 |          3        0.02       99.95
          6 |          7        0.05      100.00
------------+-----------------------------------
      Total |     13,278      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>duplicates drop y x, force
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Duplicates in terms of y x

(64 observations deleted)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen intersection_id = _n, before(y)
</pre></div>
</div>
</div>
<p>Check to remember why we dropped intersection_id 2799</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Nonsensical coordinates
drop if intersection_id ==  2799
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1 observation deleted)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>save &quot;signal_controllers_clean.dta&quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-Leading-Pedestrian-Interval-Signals-(LPIs)">
<h2>2. Leading Pedestrian Interval Signals (LPIs)<a class="headerlink" href="#2.-Leading-Pedestrian-Interval-Signals-(LPIs)" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Python</p></li>
<li><p>Explore the LPIs data using python’s Geopandas library</p></li>
<li><p>Create IDs</p></li>
<li><p>Save into Stata dta</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import geopandas as gpd
from scipy.spatial import cKDTree
from shapely.geometry import Point, MultiPoint
import pysal as ps
import libpysal
from libpysal.cg.voronoi  import voronoi, voronoi_frames

from pysal.contrib.viz import mapping as map
from pylab import *
from pysal.contrib.viz import folium_mapping as fm
import geojson as gj
import seaborn as sns
import mplleaflet as mpll

%matplotlib inline
import os
os.environ[&quot;PROJ_LIB&quot;] = &quot;C:\ProgramData\Anaconda3\Library\share&quot; #window
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\jerem\.conda\envs\geo2\lib\site-packages\pysal\__init__.py:65: VisibleDeprecationWarning: PySAL&#39;s API will be changed on 2018-12-31. The last release made with this API is version 1.14.4. A preview of the next API version is provided in the `pysal` 2.0 prelease candidate. The API changes and a guide on how to change imports is provided at https://migrating.pysal.org
  ), VisibleDeprecationWarning)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>cd
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C:\Users\jerem
</pre></div></div>
</div>
<p>Opening the Vision Zero Leading Pedestrian Interval Signals shapefile</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\VZV_Leading Pedestrian Interval Signals\geo_export_0c63b43f-83c0-4834-aa91-2c564c1bff2c.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cross_stre</th>
      <th>date_insta</th>
      <th>time_insta</th>
      <th>lat</th>
      <th>long</th>
      <th>main_stree</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dreiser loop East</td>
      <td>2018-08-01</td>
      <td>00:00:00.000</td>
      <td>40.878465</td>
      <td>-73.828273</td>
      <td>Co-op City Blvd</td>
      <td>POINT (-73.82827338235253 40.87846542795222)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>West 119 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.803958</td>
      <td>-73.948271</td>
      <td>Lenox Avenue</td>
      <td>POINT (-73.94827133431397 40.80395846158952)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>West 120 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.804587</td>
      <td>-73.947812</td>
      <td>Lenox Avenue</td>
      <td>POINT (-73.94781210658503 40.80458679730486)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x21e3d70c780&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_21_1.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_21_1.png" />
</div>
</div>
<p>First, we have to check the CRS (coordinate reference system) of the shapefile. This is important because all the other shapefiles have to be on the same projection in order to do spatial joins and identify nearest neighbors. For more information on projections, you can watch this <a class="reference external" href="https://youtu.be/KUF_Ckv8HbE">short video</a> and read this <a class="reference external" href="https://www.earthdatascience.org/courses/earth-analytics-python/spatial-data-vector-shapefiles/intro-to-coordinate-reference-systems-python/">document</a>
from <a class="reference external" href="https://www.earthdatascience.org">Earthdatascience.org</a>.</p>
<p>To see the crs of lpis_df, we use geodataframe.crs</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:4326&#39;}
</pre></div>
</div>
</div>
<p>EPSG 4326 is the coordinate system for the world. It is also known as WGS84. When you have a longitude and latitude from this CRS, you can copy and paste it into Google Maps to find that location.</p>
<p>Since we are working with New York City only, we prefer to use a projection that more accurately protrays the shape of NYC. We will reproject lpis_df to EPSG 2263 (NAD83 / New York Long Island (ftUS)).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df = lpis_df.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<p>We can see that lpis_df now has the right projection.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x21e3e917128&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_30_1.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_30_1.png" />
</div>
</div>
<p>If you look at both plots again, you will notice that the axes labels are different. This is due to the different CRS.</p>
<p>I create IDs in the dataframe, since lpis_df has no ID variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df[&#39;LPIS_ID&#39;] = lpis_df.index
lpis_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cross_stre</th>
      <th>date_insta</th>
      <th>time_insta</th>
      <th>lat</th>
      <th>long</th>
      <th>main_stree</th>
      <th>geometry</th>
      <th>LPIS_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dreiser loop East</td>
      <td>2018-08-01</td>
      <td>00:00:00.000</td>
      <td>40.878465</td>
      <td>-73.828273</td>
      <td>Co-op City Blvd</td>
      <td>POINT (1031739.000154228 259373.000004255)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>West 119 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.803958</td>
      <td>-73.948271</td>
      <td>Lenox Avenue</td>
      <td>POINT (998570.9998893011 232184.9999184268)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>West 120 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.804587</td>
      <td>-73.947812</td>
      <td>Lenox Avenue</td>
      <td>POINT (998697.9999633889 232414.0001165908)</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Next, I want to export the dataframe to a Stata dta file. Objects need to be converted to str.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Might be unnecessary
#str_cols = list(lpis_df.select_dtypes(include=[&#39;object&#39;]).columns)
#for col in str_cols:
#    lpis_df[col] = lpis_df[col].astype(str)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>#fp =  r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\VZV_LPIS_data.dta&quot;
#lpis_df.to_stata(fp)
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.-Linking-Signal-intersection-to-other-data">
<h2>3. Linking Signal intersection to other data<a class="headerlink" href="#3.-Linking-Signal-intersection-to-other-data" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>python</p></li>
<li><p>uses scipy’s cKDTree</p></li>
<li><p>connects each data to the nearest signal intersection</p></li>
</ul>
<p>Define a function to obtain IDs of nearest neighbors and distance measure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># ckdnearest function
# from &quot;https://gist.github.com/jhconning/63a34a51acff83d116adc52308faf240&quot;
def ckdnearest(gdA, gdB, bcol):
    &quot;&quot;&quot;
    This function takes geodataframes: `gdA` and `gdB` and
    a column name `bcol`. Both dataframes are assumed to have a `geometry` column.
    It finds the nearest neighbor from each location in `gdA` to a
    nearest neighbor in `gdB`.

    It returns a two-column pandas dataframe with a &#39;distance&#39; (here rounded to nearest foot)
    and the value of the `bcol` in `gdB&#39;  (e.g. &#39;school_name&#39;)
    &quot;&quot;&quot;

    nA = np.array(list(zip(gdA.geometry.x, gdA.geometry.y)) )
    nB = np.array(list(zip(gdB.geometry.x, gdB.geometry.y)) )
    btree = cKDTree(nB)
    dist, idx = btree.query(nA,k=1)
    df = pd.DataFrame.from_dict({&#39;distance&#39;: dist.astype(int),
                             &#39;bcol&#39; : gdB.loc[idx, bcol].values })
    return df
</pre></div>
</div>
</div>
<div class="section" id="3.a.-Signal-Intersections">
<h3>3.a. Signal Intersections<a class="headerlink" href="#3.a.-Signal-Intersections" title="Permalink to this headline">¶</a></h3>
<p>Read the cleaned Signal intersection Stata dta file</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Open signal intersection stata dta file
fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\DOT_traffic_signals_Oct_2018\signal_controllers_clean.dta&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df = pd.read_stata(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.609300002</td>
      <td>986336.149</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.161899999</td>
      <td>982769.331</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.618399993</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df[&#39;y&#39;].dtypes
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>dtype(&#39;O&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df[&#39;x&#39;].dtypes
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>dtype(&#39;O&#39;)
</pre></div>
</div>
</div>
<p>Convert the y and x coordinates into float</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Convert coordinates into float
sig_inters_df[&#39;y&#39;] = sig_inters_df[&#39;y&#39;].astype(float)
sig_inters_df[&#39;x&#39;] = sig_inters_df[&#39;x&#39;].astype(float)
</pre></div>
</div>
</div>
<p>Create Coordinates by combining x and y together with zip into a list</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df[&#39;Coordinates&#39;] = list(zip(sig_inters_df.x, sig_inters_df.y))
</pre></div>
</div>
</div>
<p>Turn Coordinates into shapely Points</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_df[&#39;Coordinates&#39;] = sig_inters_df[&#39;Coordinates&#39;].apply(Point)
</pre></div>
</div>
</div>
<p>Create Geopandas dataframe</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = gpd.GeoDataFrame(sig_inters_df, geometry=&#39;Coordinates&#39;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.b.-Leading-Pedestrian-Signal-Interval">
<h3>3.b. Leading Pedestrian Signal Interval<a class="headerlink" href="#3.b.-Leading-Pedestrian-Signal-Interval" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>lpis_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cross_stre</th>
      <th>date_insta</th>
      <th>time_insta</th>
      <th>lat</th>
      <th>long</th>
      <th>main_stree</th>
      <th>geometry</th>
      <th>LPIS_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Dreiser loop East</td>
      <td>2018-08-01</td>
      <td>00:00:00.000</td>
      <td>40.878465</td>
      <td>-73.828273</td>
      <td>Co-op City Blvd</td>
      <td>POINT (1031739.000154228 259373.000004255)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>West 119 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.803958</td>
      <td>-73.948271</td>
      <td>Lenox Avenue</td>
      <td>POINT (998570.9998893011 232184.9999184268)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>West 120 St</td>
      <td>2018-08-08</td>
      <td>00:00:00.000</td>
      <td>40.804587</td>
      <td>-73.947812</td>
      <td>Lenox Avenue</td>
      <td>POINT (998697.9999633889 232414.0001165908)</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For each LPIs, we want to find the closest signalized intersection</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_LPIS&#39;,&#39;nearest_LPIS&#39;]] = ckdnearest(sig_inters_gdf, lpis_df,&#39;LPIS_ID&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>nearest_LPIS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>1915</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>See the number of observations in sig_inters_gdf</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[&#39;intersection_id&#39;].count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>13213
</pre></div>
</div>
</div>
<p>We want to merge into sig_inters_gdf additional information from lpis_df</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = sig_inters_gdf.merge(lpis_df[[&#39;date_insta&#39;,&#39;LPIS_ID&#39;]], how=&#39;left&#39;, left_on=&#39;nearest_LPIS&#39;, right_on=&#39;LPIS_ID&#39;, validate =&quot;m:1&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>nearest_LPIS</th>
      <th>date_insta</th>
      <th>LPIS_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>1915</td>
      <td>2015-10-16</td>
      <td>1915</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>2016</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Remove the additional variable LPIS_ID</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.drop([&#39;LPIS_ID&#39;], axis=1, inplace=True)
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.c.-School-shapefile">
<h3>3.c. School shapefile<a class="headerlink" href="#3.c.-School-shapefile" title="Permalink to this headline">¶</a></h3>
<p>source: <a class="reference external" href="https://www.baruch.cuny.edu/confluence/display/geoportal/NYC+Geodatabase">https://www.baruch.cuny.edu/confluence/display/geoportal/NYC+Geodatabase</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\school_private_public_2263\school_private_public_2263.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>school_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>school_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uid</th>
      <th>idagency</th>
      <th>facname</th>
      <th>opname</th>
      <th>address</th>
      <th>city</th>
      <th>zipcode</th>
      <th>bcode</th>
      <th>facsubgrp</th>
      <th>factype</th>
      <th>capacity</th>
      <th>util</th>
      <th>xcoord</th>
      <th>ycoord</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>192.0</td>
      <td>321000145390</td>
      <td>Our Lady Of Refuge School</td>
      <td>Our Lady Of Refuge School</td>
      <td>2708 Briggs Avenue</td>
      <td>Bronx</td>
      <td>10458</td>
      <td>36005</td>
      <td>Non-Public K-12 Schools</td>
      <td>Elementary School - Non-public</td>
      <td>NaN</td>
      <td>267.0</td>
      <td>1.014359e+06</td>
      <td>254977.5176</td>
      <td>POINT (1014358.6833 254977.5176)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>294.0</td>
      <td>332000226225</td>
      <td>Yeshiva Toldos Yesuscher</td>
      <td>Yeshiva Toldos Yesuscher</td>
      <td>1531 63 Street</td>
      <td>Brooklyn</td>
      <td>11219</td>
      <td>36047</td>
      <td>Non-Public K-12 Schools</td>
      <td>Elementary School - Non-public</td>
      <td>NaN</td>
      <td>74.0</td>
      <td>9.857114e+05</td>
      <td>166689.5140</td>
      <td>POINT (985711.4182 166689.514)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2233.0</td>
      <td>331400225670</td>
      <td>Ohel Elozer</td>
      <td>Ohel Elozer</td>
      <td>263 Classon Ave-Ste 4b</td>
      <td>Brooklyn</td>
      <td>11205</td>
      <td>36047</td>
      <td>Non-Public K-12 Schools</td>
      <td>High School - Non-public</td>
      <td>NaN</td>
      <td>161.0</td>
      <td>9.951838e+05</td>
      <td>191390.1394</td>
      <td>POINT (995183.844 191390.1394)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>school_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;proj&#39;: &#39;lcc&#39;,
 &#39;lat_1&#39;: 41.03333333333333,
 &#39;lat_2&#39;: 40.66666666666666,
 &#39;lat_0&#39;: 40.16666666666666,
 &#39;lon_0&#39;: -74,
 &#39;x_0&#39;: 300000.0000000001,
 &#39;y_0&#39;: 0,
 &#39;datum&#39;: &#39;NAD83&#39;,
 &#39;units&#39;: &#39;us-ft&#39;,
 &#39;no_defs&#39;: True}
</pre></div>
</div>
</div>
<p>For each school, we want to find the closest signalized intersection</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_Sch&#39;,&#39;nearest_Sch&#39;]] = ckdnearest(sig_inters_gdf, school_gdf,&#39;uid&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>nearest_LPIS</th>
      <th>date_insta</th>
      <th>distance_to_Sch</th>
      <th>nearest_Sch</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>1915</td>
      <td>2015-10-16</td>
      <td>529</td>
      <td>3433.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>795</td>
      <td>38150.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>635</td>
      <td>38150.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="3.d.-Vision-Zero-Left-Turn-Calming-intervention">
<h3>3.d. Vision Zero Left Turn Calming intervention<a class="headerlink" href="#3.d.-Vision-Zero-Left-Turn-Calming-intervention" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\left_turn_traffic_calming_shapefile\left_turn_traffic_calming.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>treatment_</th>
      <th>completion</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Quick Kurb to X-walk</td>
      <td>2017-12-08</td>
      <td>POINT (-73.97604825017703 40.75144139179798)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Daylighting, Box markings, (1) 6' Rubber speed...</td>
      <td>2018-04-12</td>
      <td>POINT (-73.82577379991478 40.75635805716421)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Quick Kurb to X-walk</td>
      <td>2016-06-30</td>
      <td>POINT (-73.97719688637932 40.7643236906894)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:4326&#39;}
</pre></div>
</div>
</div>
<p>We have to reproject the geodataframe to the right CRS (EPSG 2263: NAD83 / New York Long Island (ftUS))</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf = ltc_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<p>Create ID variable for ltc_gdf</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf[&#39;LTC_ID&#39;] = ltc_gdf.index
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>ltc_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>treatment_</th>
      <th>completion</th>
      <th>geometry</th>
      <th>LTC_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Quick Kurb to X-walk</td>
      <td>2017-12-08</td>
      <td>POINT (990886.2363875993 213047.939427546)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Daylighting, Box markings, (1) 6' Rubber speed...</td>
      <td>2018-04-12</td>
      <td>POINT (1032518.714146682 214886.3347008746)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Quick Kurb to X-walk</td>
      <td>2016-06-30</td>
      <td>POINT (990566.7655698524 217741.2961825352)</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For each left turn calming intervention, we want to find the closest signalized intersection</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_LTC&#39;,&#39;nearest_LTC&#39;]] = ckdnearest(sig_inters_gdf, ltc_gdf,&#39;LTC_ID&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>nearest_LPIS</th>
      <th>date_insta</th>
      <th>distance_to_Sch</th>
      <th>nearest_Sch</th>
      <th>distance_to_LTC</th>
      <th>nearest_LTC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>1915</td>
      <td>2015-10-16</td>
      <td>529</td>
      <td>3433.0</td>
      <td>1183</td>
      <td>191</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>795</td>
      <td>38150.0</td>
      <td>411</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>635</td>
      <td>38150.0</td>
      <td>790</td>
      <td>77</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We want to merge into sig_inters_gdf additional information from ltc_gdf</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = sig_inters_gdf.merge(ltc_gdf[[&#39;treatment_&#39;, &#39;completion&#39;, &#39;LTC_ID&#39;]], how=&#39;left&#39;, left_on=&#39;nearest_LTC&#39;, right_on=&#39;LTC_ID&#39;, validate =&quot;m:1&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>nearest_LPIS</th>
      <th>date_insta</th>
      <th>distance_to_Sch</th>
      <th>nearest_Sch</th>
      <th>distance_to_LTC</th>
      <th>nearest_LTC</th>
      <th>treatment_</th>
      <th>completion</th>
      <th>LTC_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>1915</td>
      <td>2015-10-16</td>
      <td>529</td>
      <td>3433.0</td>
      <td>1183</td>
      <td>191</td>
      <td>Daylighting, Box markings, Pegatracks, Delinea...</td>
      <td>2017-12-08</td>
      <td>191</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>795</td>
      <td>38150.0</td>
      <td>411</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>2016</td>
      <td>1997-08-07</td>
      <td>635</td>
      <td>38150.0</td>
      <td>790</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>77</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.drop([&#39;LTC_ID&#39;], axis=1, inplace=True)
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.e.-Vision-Zero-Street-Improvement">
<h3>3.e. Vision Zero Street Improvement<a class="headerlink" href="#3.e.-Vision-Zero-Street-Improvement" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\street_improvement_proj_intersections_point\street_improvement_proj_intersections_point.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pjct_Name</th>
      <th>SIP_YR</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Jackson Avenue at Pulaski Bridge</td>
      <td>2009</td>
      <td>2009-07-31</td>
      <td>-</td>
      <td>POINT (997734.4838460496 210053.6281589993)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12th Ave at W. 135th St</td>
      <td>2009</td>
      <td>2009-05-09</td>
      <td>Traffic Network Chng - Pedestrian Safety</td>
      <td>POINT (995894.2742718621 238501.8740837589)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Flatbush Ave at Church Ave</td>
      <td>2009</td>
      <td>2009-09-25</td>
      <td>Pedestrian Safety - School Safety</td>
      <td>POINT (995708.027925191 176232.7026909116)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;proj&#39;: &#39;lcc&#39;,
 &#39;lat_1&#39;: 41.03333333333333,
 &#39;lat_2&#39;: 40.66666666666666,
 &#39;lat_0&#39;: 40.16666666666666,
 &#39;lon_0&#39;: -74,
 &#39;x_0&#39;: 300000.0000000001,
 &#39;y_0&#39;: 0,
 &#39;datum&#39;: &#39;NAD83&#39;,
 &#39;units&#39;: &#39;us-ft&#39;,
 &#39;no_defs&#39;: True}
</pre></div>
</div>
</div>
<p>We have to reproject the geodataframe to the right CRS (EPSG 2263: NAD83 / New York Long Island (ftUS))</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf = sip_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<p>Create ID variable for sip_gdf</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf[&#39;StImpro_ID&#39;] = sip_gdf.index
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sip_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pjct_Name</th>
      <th>SIP_YR</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>geometry</th>
      <th>StImpro_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Jackson Avenue at Pulaski Bridge</td>
      <td>2009</td>
      <td>2009-07-31</td>
      <td>-</td>
      <td>POINT (997734.4838460496 210053.6281589342)</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12th Ave at W. 135th St</td>
      <td>2009</td>
      <td>2009-05-09</td>
      <td>Traffic Network Chng - Pedestrian Safety</td>
      <td>POINT (995894.2742718621 238501.8740837032)</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Flatbush Ave at Church Ave</td>
      <td>2009</td>
      <td>2009-09-25</td>
      <td>Pedestrian Safety - School Safety</td>
      <td>POINT (995708.027925191 176232.7026908512)</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>For each street improvement project, we want to find the closest signalized intersection</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_StImpro&#39;,&#39;nearest_StImpro&#39;]] = ckdnearest(sig_inters_gdf, sip_gdf,&#39;StImpro_ID&#39;)
</pre></div>
</div>
</div>
<p>We want to merge into sig_inters_gdf additional information from sip_gdf</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = sig_inters_gdf.merge(sip_gdf[[&#39;DateComplt&#39;, &#39;SIPProjTyp&#39;, &#39;StImpro_ID&#39;]],
                                      how=&#39;left&#39;,
                                      left_on=&#39;nearest_StImpro&#39;,
                                      right_on=&#39;StImpro_ID&#39;,
                                      validate =&quot;m:1&quot;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[69]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>...</th>
      <th>nearest_Sch</th>
      <th>distance_to_LTC</th>
      <th>nearest_LTC</th>
      <th>treatment_</th>
      <th>completion</th>
      <th>distance_to_StImpro</th>
      <th>nearest_StImpro</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>StImpro_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>...</td>
      <td>3433.0</td>
      <td>1183</td>
      <td>191</td>
      <td>Daylighting, Box markings, Pegatracks, Delinea...</td>
      <td>2017-12-08</td>
      <td>272</td>
      <td>4</td>
      <td>2009-10-31</td>
      <td>-</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>...</td>
      <td>38150.0</td>
      <td>411</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2101</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>245</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>...</td>
      <td>38150.0</td>
      <td>790</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2098</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>245</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 23 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.drop([&#39;StImpro_ID&#39;], axis=1, inplace=True)
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.f.-Bike-Routes">
<h3>3.f. Bike Routes<a class="headerlink" href="#3.f.-Bike-Routes" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\bike_routes_points_2263\bike_routes_points_2263.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[72]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>br_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>br_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tf_facilit</th>
      <th>comments</th>
      <th>bikedir</th>
      <th>ft_facilit</th>
      <th>objectid_1</th>
      <th>allclasses</th>
      <th>date_instd</th>
      <th>time_instd</th>
      <th>lanecount</th>
      <th>segment_id</th>
      <th>boro</th>
      <th>street</th>
      <th>date_modda</th>
      <th>time_modda</th>
      <th>tostreet</th>
      <th>fromstreet</th>
      <th>onoffst</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Protected Path</td>
      <td>None</td>
      <td>L</td>
      <td>None</td>
      <td>1.0</td>
      <td>I</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>1.0</td>
      <td>33547</td>
      <td>1.0</td>
      <td>9 AV</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>W 31 ST</td>
      <td>W 16 ST</td>
      <td>ON</td>
      <td>POINT (984139.5802614246 211708.657997195)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Protected Path</td>
      <td>None</td>
      <td>L</td>
      <td>None</td>
      <td>1.0</td>
      <td>I</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>1.0</td>
      <td>33547</td>
      <td>1.0</td>
      <td>9 AV</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>W 31 ST</td>
      <td>W 16 ST</td>
      <td>ON</td>
      <td>POINT (984140.0661334711 211709.5320271455)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Protected Path</td>
      <td>None</td>
      <td>L</td>
      <td>None</td>
      <td>1.0</td>
      <td>I</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>1.0</td>
      <td>33547</td>
      <td>1.0</td>
      <td>9 AV</td>
      <td>None</td>
      <td>00:00:00.000</td>
      <td>W 31 ST</td>
      <td>W 16 ST</td>
      <td>ON</td>
      <td>POINT (984140.5520055175 211710.4060570961)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>br_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;proj&#39;: &#39;lcc&#39;,
 &#39;lat_1&#39;: 41.03333333333333,
 &#39;lat_2&#39;: 40.66666666666666,
 &#39;lat_0&#39;: 40.16666666666666,
 &#39;lon_0&#39;: -74,
 &#39;x_0&#39;: 300000.0000000001,
 &#39;y_0&#39;: 0,
 &#39;datum&#39;: &#39;NAD83&#39;,
 &#39;units&#39;: &#39;us-ft&#39;,
 &#39;no_defs&#39;: True}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>br_gdf = br_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_bikeroute&#39;,&#39;nearest_bikeroute&#39;]] = ckdnearest(sig_inters_gdf, br_gdf,&#39;objectid_1&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>...</th>
      <th>distance_to_LTC</th>
      <th>nearest_LTC</th>
      <th>treatment_</th>
      <th>completion</th>
      <th>distance_to_StImpro</th>
      <th>nearest_StImpro</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>distance_to_bikeroute</th>
      <th>nearest_bikeroute</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>...</td>
      <td>1183</td>
      <td>191</td>
      <td>Daylighting, Box markings, Pegatracks, Delinea...</td>
      <td>2017-12-08</td>
      <td>272</td>
      <td>4</td>
      <td>2009-10-31</td>
      <td>-</td>
      <td>3</td>
      <td>8553.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>...</td>
      <td>411</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2101</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>230</td>
      <td>1778.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>...</td>
      <td>790</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2098</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>1</td>
      <td>1769.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 24 columns</p>
</div></div>
</div>
</div>
<div class="section" id="3.g.-Borough">
<h3>3.g. Borough<a class="headerlink" href="#3.g.-Borough" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\nyc_boroughs_2263\nyc_boroughs_2263.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[81]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bcode</th>
      <th>bname</th>
      <th>name</th>
      <th>namelsad</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>36005</td>
      <td>Bronx</td>
      <td>Bronx</td>
      <td>Bronx County</td>
      <td>(POLYGON ((1008982.068976385 272752.8735210547...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>36047</td>
      <td>Brooklyn</td>
      <td>Kings</td>
      <td>Kings County</td>
      <td>(POLYGON ((978869.3811487257 186863.7807399245...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>(POLYGON ((1007701.483091666 258286.8905491272...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36081</td>
      <td>Queens</td>
      <td>Queens</td>
      <td>Queens County</td>
      <td>(POLYGON ((1026830.772887008 155435.7100568501...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>36085</td>
      <td>Staten Island</td>
      <td>Richmond</td>
      <td>Richmond County</td>
      <td>(POLYGON ((930721.1281812892 156627.9162643671...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[82]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf.crs = sig_inters_gdf.crs
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[83]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = gpd.sjoin(sig_inters_gdf,borough_gdf[[&#39;bname&#39;, &#39;geometry&#39;]], how=&#39;left&#39;, op=&#39;intersects&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.drop(&#39;index_right&#39;, axis=1, inplace=True)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>...</th>
      <th>nearest_LTC</th>
      <th>treatment_</th>
      <th>completion</th>
      <th>distance_to_StImpro</th>
      <th>nearest_StImpro</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>distance_to_bikeroute</th>
      <th>nearest_bikeroute</th>
      <th>bname</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>...</td>
      <td>191</td>
      <td>Daylighting, Box markings, Pegatracks, Delinea...</td>
      <td>2017-12-08</td>
      <td>272</td>
      <td>4</td>
      <td>2009-10-31</td>
      <td>-</td>
      <td>3</td>
      <td>8553.0</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>...</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2101</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>230</td>
      <td>1778.0</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>...</td>
      <td>77</td>
      <td>Quick Kurb to x-walk</td>
      <td>2017-12-08</td>
      <td>2098</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>1</td>
      <td>1769.0</td>
      <td>Manhattan</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 25 columns</p>
</div></div>
</div>
</div>
<div class="section" id="3.h.-Priority-Intersections">
<h3>3.h. Priority Intersections<a class="headerlink" href="#3.h.-Priority-Intersections" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[86]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\vz_priority_intersections_shapefile\vz_priority_intersections_shapefile\vz_priority_intersections.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>pi_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>pi_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:4326&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>pi_gdf = pi_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>pi_gdf[&#39;priority_inters_ID&#39;] = pi_gdf.index
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf[[&#39;distance_to_priorityinters&#39;,&#39;nearest_priorityinters&#39;]] = ckdnearest(sig_inters_gdf, pi_gdf,&#39;priority_inters_ID&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>...</th>
      <th>completion</th>
      <th>distance_to_StImpro</th>
      <th>nearest_StImpro</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>distance_to_bikeroute</th>
      <th>nearest_bikeroute</th>
      <th>bname</th>
      <th>distance_to_priorityinters</th>
      <th>nearest_priorityinters</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>...</td>
      <td>2017-12-08</td>
      <td>272</td>
      <td>4</td>
      <td>2009-10-31</td>
      <td>-</td>
      <td>3</td>
      <td>8553.0</td>
      <td>Manhattan</td>
      <td>7</td>
      <td>245</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>...</td>
      <td>2017-12-08</td>
      <td>2101</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>230</td>
      <td>1778.0</td>
      <td>Manhattan</td>
      <td>2289</td>
      <td>191</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>...</td>
      <td>2017-12-08</td>
      <td>2098</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>1</td>
      <td>1769.0</td>
      <td>Manhattan</td>
      <td>2331</td>
      <td>191</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 27 columns</p>
</div></div>
</div>
</div>
<div class="section" id="3.i.-Safe-Streets-for-Seniors">
<h3>3.i. Safe Streets for Seniors<a class="headerlink" href="#3.i.-Safe-Streets-for-Seniors" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\safe_streets_for_seniors_shapefile\safe_streets_for_seniors.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>seniors_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>seniors_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[95]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:4326&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[96]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>seniors_gdf = seniors_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[97]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>seniors_gdf[&#39;seniors_ID&#39;] = seniors_gdf.index
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>seniors_gdf.crs = sig_inters_gdf.crs
</pre></div>
</div>
</div>
<p>Spatial Join to identify intersections within Senior Zones</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[99]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf = gpd.sjoin(sig_inters_gdf, seniors_gdf[[&#39;Name&#39;, &#39;seniors_ID&#39;,&#39;geometry&#39;]], how=&#39;left&#39;, op=&#39;within&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[100]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.drop(&#39;index_right&#39;, axis=1, inplace=True)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[101]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_LPIS</th>
      <th>...</th>
      <th>nearest_StImpro</th>
      <th>DateComplt</th>
      <th>SIPProjTyp</th>
      <th>distance_to_bikeroute</th>
      <th>nearest_bikeroute</th>
      <th>bname</th>
      <th>distance_to_priorityinters</th>
      <th>nearest_priorityinters</th>
      <th>Name</th>
      <th>seniors_ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
      <td>POINT (986336.149 199793.609300002)</td>
      <td>276</td>
      <td>...</td>
      <td>4</td>
      <td>2009-10-31</td>
      <td>-</td>
      <td>3</td>
      <td>8553.0</td>
      <td>Manhattan</td>
      <td>7</td>
      <td>245</td>
      <td>Lower East Side</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
      <td>POINT (982769.331 202206.161899999)</td>
      <td>592</td>
      <td>...</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>230</td>
      <td>1778.0</td>
      <td>Manhattan</td>
      <td>2289</td>
      <td>191</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
      <td>413</td>
      <td>...</td>
      <td>245</td>
      <td>2016-07-23</td>
      <td>VZ Priority Geo - Traffic Calming</td>
      <td>1</td>
      <td>1769.0</td>
      <td>Manhattan</td>
      <td>2331</td>
      <td>191</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 29 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[102]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>str_cols = list(sig_inters_gdf.select_dtypes(include=[&#39;object&#39;]).columns)
for col in str_cols:
    sig_inters_gdf[col] = sig_inters_gdf[col].astype(str)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[103]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp =  r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\signal_intersection.dta&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>#sig_inters_gdf.to_stata(fp)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="4.-NYPD-Motor-Vehicle-Collision-data">
<h2>4. NYPD Motor Vehicle Collision data<a class="headerlink" href="#4.-NYPD-Motor-Vehicle-Collision-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="4.a.-download">
<h3>4.a. download<a class="headerlink" href="#4.a.-download" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>stata</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[104]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>clear
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[105]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>import delimited &quot;https://data.cityofnewyork.us/api/views/h9gi-nx95/rows.csv?accessType=DOWNLOAD&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(29 vars, 1,482,622 obs)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[106]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>notes: &quot;Downloaded $S_DATE $S_TIME&quot;
notes list
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>



_dta:
  1.  &#34;Downloaded 25 Apr 2019 10:52:22&#34;
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">save</span></code> is commented out so I do not replace my original dataset</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>//save &quot;..\input_data\NYPD_Motor_Vehicle_Collisions.dta&quot;
</pre></div>
</div>
</div>
</div>
<div class="section" id="4.b.-clean">
<h3>4.b. clean<a class="headerlink" href="#4.b.-clean" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>stata</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[233]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>use &quot;..\input_data\NYPD_Motor_Vehicle_Collisions.dta&quot;,clear
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[234]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>notes list
//Check that notes is &quot;Downloaded 28 Sep 2018 15:48:00&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

_dta:
  1.  &#34;Downloaded 28 Sep 2018 15:48:00&#34;
</pre></div></div>
</div>
<p>Formatting the data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[235]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>%head
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>time</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>location</th>
      <th>onstreetname</th>
      <th>crossstreetname</th>
      <th>offstreetname</th>
      <th>numberofpersonsinjured</th>
      <th>numberofpersonskilled</th>
      <th>numberofpedestriansinjured</th>
      <th>numberofpedestrianskilled</th>
      <th>numberofcyclistinjured</th>
      <th>numberofcyclistkilled</th>
      <th>numberofmotoristinjured</th>
      <th>numberofmotoristkilled</th>
      <th>contributingfactorvehicle1</th>
      <th>contributingfactorvehicle2</th>
      <th>contributingfactorvehicle3</th>
      <th>contributingfactorvehicle4</th>
      <th>contributingfactorvehicle5</th>
      <th>uniquekey</th>
      <th>vehicletypecode1</th>
      <th>vehicletypecode2</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>09/24/2018</td>
      <td>0:00</td>
      <td>STATEN ISLAND</td>
      <td>10306</td>
      <td>40.573219</td>
      <td>-74.106995</td>
      <td>(40.57322, -74.106995)</td>
      <td>HYLAN BOULEVARD</td>
      <td>OTIS AVENUE</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3987045</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>2</th>
      <td>09/24/2018</td>
      <td>0:00</td>
      <td>.</td>
      <td>.</td>
      <td>40.612614</td>
      <td>-74.076958</td>
      <td>(40.612614, -74.07696)</td>
      <td>FLETCHER STREET</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3987187</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>09/24/2018</td>
      <td>0:00</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>161-18    140 street</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986792</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>4</th>
      <td>09/24/2018</td>
      <td>0:00</td>
      <td>.</td>
      <td>.</td>
      <td>40.833981</td>
      <td>-73.826347</td>
      <td>(40.83398, -73.82635)</td>
      <td>BRUCKNER EXPRESSWAY</td>
      <td>.</td>
      <td>.</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Unsafe Speed</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986861</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>5</th>
      <td>09/24/2018</td>
      <td>0:05</td>
      <td>BROOKLYN</td>
      <td>11249</td>
      <td>40.720074</td>
      <td>-73.959846</td>
      <td>(40.720074, -73.95985)</td>
      <td>WYTHE AVENUE</td>
      <td>NORTH 8 STREET</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Failure to Yield Right-of-Way</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986532</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>6</th>
      <td>09/24/2018</td>
      <td>0:28</td>
      <td>BROOKLYN</td>
      <td>11210</td>
      <td>40.631283</td>
      <td>-73.94603</td>
      <td>(40.631283, -73.94603)</td>
      <td>.</td>
      <td>.</td>
      <td>1609      FLATBUSH AVENUE</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Driver Inattention/Distraction</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986656</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>7</th>
      <td>09/24/2018</td>
      <td>0:30</td>
      <td>QUEENS</td>
      <td>11385</td>
      <td>40.693848</td>
      <td>-73.901184</td>
      <td>(40.693848, -73.901184)</td>
      <td>CODY AVENUE</td>
      <td>WYCKOFF AVENUE</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Passing or Lane Usage Improper</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3988303</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>8</th>
      <td>09/24/2018</td>
      <td>0:45</td>
      <td>.</td>
      <td>.</td>
      <td>40.678162</td>
      <td>-73.897484</td>
      <td>(40.67816, -73.897484)</td>
      <td>PENNSYLVANIA AVENUE</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Aggressive Driving/Road Rage</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986730</td>
      <td>Sedan</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>9</th>
      <td>09/24/2018</td>
      <td>10:00</td>
      <td>BROOKLYN</td>
      <td>11201</td>
      <td>40.702908</td>
      <td>-73.981133</td>
      <td>(40.702908, -73.98113)</td>
      <td>WATER STREET</td>
      <td>HUDSON AVENUE</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Turning Improperly</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986916</td>
      <td>Station Wagon/Sport Utility Vehicle</td>
      <td>Sedan</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <th>10</th>
      <td>09/24/2018</td>
      <td>10:00</td>
      <td>BROOKLYN</td>
      <td>11201</td>
      <td>40.694687</td>
      <td>-73.981743</td>
      <td>(40.694687, -73.98174)</td>
      <td>.</td>
      <td>.</td>
      <td>38        FLEET WALK</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Backing Unsafely</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>3986791</td>
      <td>Box Truck</td>
      <td>Flat Bed</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[236]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>order(uniquekey), before(date)
</pre></div>
</div>
</div>
<p>Create dates that are in the Stata internal form(SIF) that Stata can understand</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[237]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>codebook date
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
date                                                                                                                                                                                                                                                       DATE
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  string (str105)

         unique values:  2,278                    missing &#34;&#34;:  0/1,351,215

              examples:  &#34;03/22/2016&#34;
                         &#34;06/05/2015&#34;
                         &#34;08/10/2015&#34;
                         &#34;10/17/2014&#34;

               warning:  variable has leading and embedded blanks
</pre></div></div>
</div>
<p>The date variable is a string in the format of month day and year. Therefore, we will use Stata’s mask MDY to create the date in SIF.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[238]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen date2 = date(date, &quot;MDY&quot;),after(date)
format date2 %td
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(1 missing value generated)

</pre></div></div>
</div>
<p>There is an observation with nonsensical values in the date str variable</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[239]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>drop date
rename date2 date
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[240]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen time2 = clock(time, &quot;hm&quot;),after(time)
format time2 %tcHH:MM
drop time
rename time2 time
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(1 missing value generated)



</pre></div></div>
</div>
<p>We can easily extract year from SIF data</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[241]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen year = year(date), before(date)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1 missing value generated)
</pre></div></div>
</div>
<p>Create latenight indicator variable</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[242]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen latenight = (time &gt; tc(23:00:00) &amp; time &lt;= tc(23:59:59)) | (time &gt;= tc(00:00:00) &amp; time &lt; tc(05:00:00)), after(time)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[243]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab latenight
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

  latenight |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,218,191       90.16       90.16
          1 |    133,024        9.84      100.00
------------+-----------------------------------
      Total |  1,351,215      100.00
</pre></div></div>
</div>
<p>Rename long variable names</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[244]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>rename numberofpersonsinjured personsinjured
rename numberofpersonskilled personskilled
rename numberofpedestriansinjured pedestriansinjured
rename numberofpedestrianskilled pedestrianskilled
rename numberofcyclistinjured cyclistinjured
rename numberofcyclistkilled cyclistkilled
rename numberofmotoristinjured motoristinjured
rename numberofmotoristkilled motoristkilled
</pre></div>
</div>
</div>
<p>Create an indicator for observations with missing Longditude and Latitude points</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[245]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen mi_latlong = mi(latitude) &amp; mi(longitude), after(longitude)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[246]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab mi_latlong year, column
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

           |                                     year
mi_latlong |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    85,450    171,914    172,724    182,956    145,733    212,986    155,901 | 1,127,664
           |     84.99      84.39      83.84      84.05      63.96      92.84      93.93 |     83.46
-----------+-----------------------------------------------------------------------------+----------
         1 |    15,089     31,809     33,302     34,731     82,104     16,437     10,078 |   223,550
           |     15.01      15.61      16.16      15.95      36.04       7.16       6.07 |     16.54
-----------+-----------------------------------------------------------------------------+----------
     Total |   100,539    203,723    206,026    217,687    227,837    229,423    165,979 | 1,351,214
           |    100.00     100.00     100.00     100.00     100.00     100.00     100.00 |    100.00
</pre></div></div>
</div>
<p>Use Stata’s <code class="docutils literal notranslate"><span class="pre">duplicates</span></code> command to identify duplicates among onstreetname and crossstreetname</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[247]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>duplicates report onstreetname crossstreetname if ///
!missing(onstreetname) &amp; !missing(crossstreetname)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Duplicates in terms of onstreetname crossstreetname

--------------------------------------
   copies | observations       surplus
----------+---------------------------
        1 |        42735             0
        2 |        42570         21285
        3 |        43125         28750
        4 |        43116         32337
        5 |        40200         32160
        6 |        37398         31165
        7 |        34363         29454
        8 |        32688         28602
        9 |        30033         26696
       10 |        28170         25353
       11 |        26191         23810
       12 |        23868         21879
       13 |        22945         21180
       14 |        21154         19643
       15 |        19485         18186
       16 |        17856         16740
       17 |        16881         15888
       18 |        17046         16099
       19 |        14725         13950
       20 |        14660         13927
       21 |        12810         12200
       22 |        12562         11991
       23 |        11638         11132
       24 |        11688         11201
       25 |        10525         10104
       26 |        10166          9775
       27 |         9936          9568
       28 |         9912          9558
       29 |         7743          7476
       30 |         8340          8062
       31 |         7750          7500
       32 |         7584          7347
       33 |         6864          6656
       34 |         8058          7821
       35 |         8050          7820
       36 |         6876          6685
       37 |         7178          6984
       38 |         6384          6216
       39 |         5538          5396
       40 |         5880          5733
       41 |         5166          5040
       42 |         5250          5125
       43 |         3612          3528
       44 |         5588          5461
       45 |         3915          3828
       46 |         3956          3870
       47 |         4606          4508
       48 |         3840          3760
       49 |         4410          4320
       50 |         4350          4263
       51 |         3774          3700
       52 |         3640          3570
       53 |         3127          3068
       54 |         4212          4134
       55 |         3850          3780
       56 |         2912          2860
       57 |         2622          2576
       58 |         3074          3021
       59 |         3186          3132
       60 |         3420          3363
       61 |         2989          2940
       62 |         2976          2928
       63 |         1827          1798
       64 |         2624          2583
       65 |         2015          1984
       66 |         2376          2340
       67 |         1876          1848
       68 |         2176          2144
       69 |         2415          2380
       70 |         2030          2001
       71 |         2059          2030
       72 |         1800          1775
       73 |         2190          2160
       74 |         2590          2555
       75 |         1725          1702
       76 |         1520          1500
       77 |         2079          2052
       78 |         1248          1232
       79 |         1501          1482
       80 |         1920          1896
       81 |         1701          1680
       82 |         1804          1782
       83 |          498           492
       84 |         1764          1743
       85 |         2720          2688
       86 |         1634          1615
       87 |         1305          1290
       88 |         1760          1740
       89 |         1068          1056
       90 |          720           712
       91 |         1183          1170
       92 |          920           910
       93 |         1953          1932
       94 |         1034          1023
       95 |         1520          1504
       96 |         1344          1330
       97 |         1552          1536
       98 |         1372          1358
       99 |         1287          1274
      100 |         1400          1386
      101 |         1313          1300
      102 |          816           808
      103 |          515           510
      104 |          624           618
      105 |          945           936
      106 |          954           945
      107 |          856           848
      108 |         1728          1712
      109 |          763           756
      110 |         1430          1417
      111 |         1110          1100
      112 |          448           444
      113 |          565           560
      114 |          798           791
      115 |          805           798
      116 |         1044          1035
      117 |          702           696
      118 |          590           585
      119 |          952           944
      120 |          480           476
      121 |          484           480
      122 |          976           968
      123 |          738           732
      124 |          620           615
      125 |          875           868
      126 |          378           375
      127 |          381           378
      128 |          640           635
      129 |          387           384
      130 |          260           258
      131 |          262           260
      132 |          396           393
      133 |         1197          1188
      134 |         1340          1330
      135 |          540           536
      136 |          544           540
      137 |          548           544
      138 |          414           411
      139 |          278           276
      140 |          840           834
      141 |          705           700
      142 |         1136          1128
      143 |          286           284
      145 |          725           720
      146 |         1022          1015
      147 |          588           584
      148 |          444           441
      149 |          447           444
      151 |         1057          1050
      152 |          760           755
      153 |          153           152
      154 |          154           153
      155 |          310           308
      156 |          312           310
      157 |          157           156
      158 |          316           314
      159 |          636           632
      160 |          480           477
      161 |          966           960
      162 |          486           483
      163 |          163           162
      165 |          330           328
      166 |          498           495
      167 |          167           166
      168 |          336           334
      169 |          507           504
      170 |          170           169
      171 |          342           340
      172 |          688           684
      173 |          173           172
      174 |          174           173
      175 |          525           522
      176 |          704           700
      177 |          177           176
      178 |          356           354
      179 |          358           356
      180 |          360           358
      185 |          370           368
      186 |          372           370
      189 |          189           188
      190 |          380           378
      191 |          382           380
      192 |          192           191
      196 |          588           585
      197 |          197           196
      199 |          199           198
      200 |          200           199
      202 |          202           201
      206 |          206           205
      208 |          624           621
      210 |          210           209
      212 |          636           633
      213 |          213           212
      214 |          214           213
      216 |          432           430
      218 |          218           217
      219 |          219           218
      223 |          223           222
      225 |          225           224
      229 |          229           228
      231 |          231           230
      234 |          234           233
      235 |          235           234
      238 |          238           237
      241 |          241           240
      244 |          244           243
      245 |          245           244
      255 |          510           508
      263 |          263           262
      266 |          266           265
      269 |          269           268
      278 |          278           277
      280 |          280           279
      287 |          287           286
      288 |          288           287
      292 |          292           291
      297 |          297           296
      299 |          299           298
      306 |          306           305
      317 |          317           316
      326 |          326           325
      343 |          343           342
      351 |          351           350
      359 |          359           358
      400 |          400           399
      408 |          408           407
    24990 |        24990         24989
--------------------------------------
</pre></div></div>
</div>
<p>use Stata’s <code class="docutils literal notranslate"><span class="pre">strtrim</span></code> function to remove leading and trailing spaces</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[248]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>replace onstreetname = strtrim(onstreetname)
replace crossstreetname = strtrim(crossstreetname)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(1,079,830 real changes made)

(738,472 real changes made)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[249]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sort onstreetname crossstreetname borough zipcode latitude longitude
</pre></div>
</div>
</div>
<p>If borough, zipcode, on street and cross street are the same, we will use the latitude and longitudes for those observations for observations with missing coordinates. s</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[250]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>replace latitude = latitude[_n-1] if ///
mi(latitude) &amp; ///
!mi(latitude[_n-1]) &amp; ///
!mi(borough) &amp; ///
!mi(borough[_n-1]) &amp; ///
!mi(zipcode) &amp; ///
!mi(zipcode[_n-1]) &amp; ///
!mi(onstreetname) &amp; ///
!mi(onstreetname[_n-1]) &amp; ///
!mi(crossstreetname) &amp; ///
!mi(crossstreetname[_n-1]) &amp; ///
(borough == borough[_n-1]) &amp; ///
(zipcode == zipcode[_n-1]) &amp; ///
(onstreetname == onstreetname[_n-1]) &amp; ///
(crossstreetname ==  crossstreetname[_n-1])

replace longitude = longitude[_n-1] if ///
mi(longitude) &amp; ///
!mi(longitude[_n-1]) &amp; ///
!mi(borough) &amp; ///
!mi(borough[_n-1]) &amp; ///
!mi(zipcode) &amp; ///
!mi(zipcode[_n-1]) &amp; ///
!mi(onstreetname) &amp; ///
!mi(onstreetname[_n-1]) &amp; ///
!mi(crossstreetname) &amp; ///
!mi(crossstreetname[_n-1]) &amp; ///
(borough == borough[_n-1]) &amp; ///
(zipcode == zipcode[_n-1]) &amp; ///
(onstreetname == onstreetname[_n-1]) &amp; ///
(crossstreetname ==  crossstreetname[_n-1])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(22,579 real changes made)

(22,579 real changes made)
</pre></div></div>
</div>
<p>Create indicator for observations which had their coordinates filled</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[251]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen imput_latlong = (mi_latlong ==1 &amp; !mi(latitude) &amp; !mi(longitude)), after(mi_latlong)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[252]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab imput_latlong
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

imput_latlo |
         ng |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,328,636       98.33       98.33
          1 |     22,579        1.67      100.00
------------+-----------------------------------
      Total |  1,351,215      100.00
</pre></div></div>
</div>
<p>Create a second indicator for those observations that still have missing coordinates</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[253]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen mi_latlong2 = mi(latitude) &amp; mi(longitude), after(imput_latlong)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[254]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab mi_latlong2 year, column
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

mi_latlong |                                     year
         2 |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    85,452    171,917    172,730    182,959    164,166    215,363    157,656 | 1,150,243
           |     84.99      84.39      83.84      84.05      72.05      93.87      94.99 |     85.13
-----------+-----------------------------------------------------------------------------+----------
         1 |    15,087     31,806     33,296     34,728     63,671     14,060      8,323 |   200,971
           |     15.01      15.61      16.16      15.95      27.95       6.13       5.01 |     14.87
-----------+-----------------------------------------------------------------------------+----------
     Total |   100,539    203,723    206,026    217,687    227,837    229,423    165,979 | 1,351,214
           |    100.00     100.00     100.00     100.00     100.00     100.00     100.00 |    100.00
</pre></div></div>
</div>
<p>Drop observations whose coordinates fall outside NYC’s boundary box</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[255]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>drop if (longitude &lt; -74.5 | longitude &gt; -73) &amp;  !mi(longitude)
drop if (latitude &lt; 40 |  latitude &gt; 41) &amp; !mi(latitude)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(439 observations deleted)

(4 observations deleted)
</pre></div></div>
</div>
<p>Drop observations that have missing coordinates</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[256]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>drop if mi_latlong2 == 1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(200,972 observations deleted)
</pre></div></div>
</div>
<p>Cross tabulation of missing coordinates by year</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[257]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab mi_latlong2 year, column
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

mi_latlong |                                     year
         2 |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    85,452    171,917    172,730    182,959    164,159    215,211    157,372 | 1,149,800
           |    100.00     100.00     100.00     100.00     100.00     100.00     100.00 |    100.00
-----------+-----------------------------------------------------------------------------+----------
     Total |    85,452    171,917    172,730    182,959    164,159    215,211    157,372 | 1,149,800
           |    100.00     100.00     100.00     100.00     100.00     100.00     100.00 |    100.00
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>//save &quot;..\working_data\NYPD_Motor_Vehicle_Collisions_clean.dta&quot;
</pre></div>
</div>
</div>
</div>
<div class="section" id="4.c.-link-to-signal-intersection">
<h3>4.c. link to signal intersection<a class="headerlink" href="#4.c.-link-to-signal-intersection" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>python</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[258]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\NYPD_Motor_Vehicle_Collisions_clean.dta&quot;
collision_df = pd.read_stata(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[259]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[259]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniquekey</th>
      <th>year</th>
      <th>date</th>
      <th>time</th>
      <th>latenight</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>mi_latlong</th>
      <th>...</th>
      <th>contributingfactorvehicle5</th>
      <th>vehicletypecode1</th>
      <th>vehicletypecode2</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
      <th>bicyclerelated</th>
      <th>taxirelated</th>
      <th>publicrelated</th>
      <th>dup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3427749.0</td>
      <td>2016.0</td>
      <td>2016-04-24</td>
      <td>1960-01-01 18:02:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.744896</td>
      <td>-73.770203</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3474445.0</td>
      <td>2016.0</td>
      <td>2016-07-05</td>
      <td>1960-01-01 01:30:00</td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td>40.650494</td>
      <td>-74.011772</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3467416.0</td>
      <td>2016.0</td>
      <td>2016-06-22</td>
      <td>1960-01-01 12:15:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.705044</td>
      <td>-73.959030</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 38 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[260]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_df[&quot;longitude&quot;].dtype
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[260]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>dtype(&#39;float32&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[261]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_df[&#39;Coordinates&#39;] = list(zip(collision_df.longitude, collision_df.latitude))
collision_df[&#39;Coordinates&#39;] = collision_df[&#39;Coordinates&#39;].apply(Point)
collision_gdf = gpd.GeoDataFrame(collision_df, geometry=&#39;Coordinates&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[262]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[262]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniquekey</th>
      <th>year</th>
      <th>date</th>
      <th>time</th>
      <th>latenight</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>mi_latlong</th>
      <th>...</th>
      <th>vehicletypecode1</th>
      <th>vehicletypecode2</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
      <th>bicyclerelated</th>
      <th>taxirelated</th>
      <th>publicrelated</th>
      <th>dup</th>
      <th>Coordinates</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3427749.0</td>
      <td>2016.0</td>
      <td>2016-04-24</td>
      <td>1960-01-01 18:02:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.744896</td>
      <td>-73.770203</td>
      <td>0.0</td>
      <td>...</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (-73.77020263671875 40.74489593505859)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3474445.0</td>
      <td>2016.0</td>
      <td>2016-07-05</td>
      <td>1960-01-01 01:30:00</td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td>40.650494</td>
      <td>-74.011772</td>
      <td>0.0</td>
      <td>...</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (-74.01177215576172 40.65049362182617)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3467416.0</td>
      <td>2016.0</td>
      <td>2016-06-22</td>
      <td>1960-01-01 12:15:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.705044</td>
      <td>-73.959030</td>
      <td>0.0</td>
      <td>...</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (-73.95903015136719 40.70504379272461)</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 39 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[263]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[263]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x21f27f0ba90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_202_1.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_202_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[264]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.crs = {&#39;init&#39; :&#39;epsg:4326&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[265]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf = collision_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[266]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[266]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[267]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_206_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_206_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[274]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\DOT_traffic_signals_Oct_2018\signal_controllers_clean.dta&quot;
sig_inters_df2 = pd.read_stata(fp)
sig_inters_df2.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[274]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>st4_name</th>
      <th>dup</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>199793.609300002</td>
      <td>986336.149</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td></td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>202206.161899999</td>
      <td>982769.331</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>201790.0942</td>
      <td>982805.618399993</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td></td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[275]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Convert coordinates into float
sig_inters_df2[&#39;y&#39;] = sig_inters_df2[&#39;y&#39;].astype(float)
sig_inters_df2[&#39;x&#39;] = sig_inters_df2[&#39;x&#39;].astype(float)
# Put the latitude and longtitude
sig_inters_df2[&#39;Coordinates&#39;] = list(zip(sig_inters_df2.x, sig_inters_df2.y))
sig_inters_df2[&#39;Coordinates&#39;] = sig_inters_df2[&#39;Coordinates&#39;].apply(Point)
sig_inters_gdf2 = gpd.GeoDataFrame(sig_inters_df2, geometry=&#39;Coordinates&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[277]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf2.crs
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[279]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sig_inters_gdf2.crs = {&#39;init&#39; :&#39;epsg:2263&#39;}
sig_inters_gdf2.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[279]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[280]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf[[&#39;distance_to_sigInt&#39;,&#39;nearest_sigInt&#39;]] = ckdnearest(collision_gdf, sig_inters_gdf2,&#39;intersection_id&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[281]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[281]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>uniquekey</th>
      <th>year</th>
      <th>date</th>
      <th>time</th>
      <th>latenight</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>mi_latlong</th>
      <th>...</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
      <th>bicyclerelated</th>
      <th>taxirelated</th>
      <th>publicrelated</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_sigInt</th>
      <th>nearest_sigInt</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3427749.0</td>
      <td>2016.0</td>
      <td>2016-04-24</td>
      <td>1960-01-01 18:02:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.744896</td>
      <td>-73.770203</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (1047925.420187834 210745.8332306232)</td>
      <td>749</td>
      <td>11247.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3474445.0</td>
      <td>2016.0</td>
      <td>2016-07-05</td>
      <td>1960-01-01 01:30:00</td>
      <td>1.0</td>
      <td></td>
      <td></td>
      <td>40.650494</td>
      <td>-74.011772</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (980983.3829843847 176268.9676320423)</td>
      <td>30</td>
      <td>5677.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3467416.0</td>
      <td>2016.0</td>
      <td>2016-06-22</td>
      <td>1960-01-01 12:15:00</td>
      <td>0.0</td>
      <td></td>
      <td></td>
      <td>40.705044</td>
      <td>-73.959030</td>
      <td>0.0</td>
      <td>...</td>
      <td></td>
      <td></td>
      <td></td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>24989.0</td>
      <td>POINT (995609.2936718578 196145.5996373807)</td>
      <td>111</td>
      <td>7617.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 41 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[282]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>str_cols = list(collision_gdf.select_dtypes(include=[&#39;object&#39;]).columns)
for col in str_cols:
    collision_gdf[col] = collision_gdf[col].astype(str)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp =  r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\collision_signal_intersection.dta&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>#collision_gdf.to_stata(fp)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="5.-Calculate-collision-outcomes">
<h2>5. Calculate collision outcomes<a class="headerlink" href="#5.-Calculate-collision-outcomes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>stata</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[286]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>use &quot;..\working_data\collision_signal_intersection.dta&quot;,clear
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[287]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>describe
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Contains data from ..\working_data\collision_signal_intersection.dta
  obs:     1,147,839
 vars:            42                          15 Nov 2018 16:01
 size:   896,462,259
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
index           long    %12.0g
uniquekey       double  %10.0g
year            float   %9.0g
date            str10   %10s
time            str19   %19s
latenight       float   %9.0g
borough         str13   %13s
zipcode         str5    %5s
latitude        float   %9.0g
longitude       float   %9.0g
mi_latlong      float   %9.0g
imput_latlong   float   %9.0g
mi_latlong2     float   %9.0g
location        str25   %25s
onstreetname    str32   %32s
crossstreetname str32   %32s
offstreetname   str40   %40s
personsinjured  double  %10.0g
personskilled   double  %10.0g
pedestriansin~d double  %10.0g
pedestrianski~d double  %10.0g
cyclistinjured  double  %10.0g
cyclistkilled   double  %10.0g
motoristinjured double  %10.0g
motoristkilled  double  %10.0g
contributingf~1 str53   %53s
contributingf~2 str53   %53s
contributingf~3 str53   %53s
contributingf~4 str53   %53s
contributingf~5 str43   %43s
vehicletypeco~1 str35   %35s
vehicletypeco~2 str35   %35s
vehicletypeco~3 str35   %35s
vehicletypeco~4 str35   %35s
vehicletypeco~5 str35   %35s
bicyclerelated  float   %9.0g
taxirelated     float   %9.0g
publicrelated   float   %9.0g
dup             double  %10.0g
Coordinates     str43   %43s
distance_to_s~t long    %12.0g
nearest_sigInt  float   %9.0g
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[288]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen intersection_id = nearest_sigInt
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[289]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>codebook intersection_id
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
intersection_id                                                                                                                                                      (unlabeled)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  numeric (float)

                 range:  [1,13214]                    units:  1
         unique values:  13,116                   missing .:  0/1,147,839

                  mean:    6513.4
              std. dev:   3979.88

           percentiles:        10%       25%       50%       75%       90%
                               981      3009      6437     10260     11828
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[290]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Determine if collisions that are close to an intersection
sum distance_to_sigInt, detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                     distance_to_sigInt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            2              0
 5%            2              0
10%            2              0       Obs           1,147,839
25%            3              0       Sum of Wgt.   1,147,839

50%           10                      Mean           208.3536
                        Largest       Std. Dev.      375.8735
75%          279           7498
90%          615           7500       Variance       141280.9
95%          853           7500       Skewness       4.267881
99%         1632           7685       Kurtosis       35.85233
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[291]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_sigInt if distance_to_sigInt &lt; r(p75), detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                     distance_to_sigInt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              0
 5%            2              0
10%            2              0       Obs             859,866
25%            3              0       Sum of Wgt.     859,866

50%            3                      Mean           51.85574
                        Largest       Std. Dev.      86.39933
75%           65            278
90%          227            278       Variance       7464.844
95%          259            278       Skewness       1.550851
99%          273            278       Kurtosis       3.837138
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[295]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_sigInt if distance_to_sigInt &lt; r(p75), detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                     distance_to_sigInt
-------------------------------------------------------------
      Percentiles      Smallest
 1%            2              0
 5%            2              0
10%            2              0       Obs           1,147,839
25%            3              0       Sum of Wgt.   1,147,839

50%           10                      Mean           208.3536
                        Largest       Std. Dev.      375.8735
75%          279           7498
90%          615           7500       Variance       141280.9
95%          853           7500       Skewness       4.267881
99%         1632           7685       Kurtosis       35.85233
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[298]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen intersection = (distance_to_sigInt &lt; 10)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[299]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab intersection
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

intersectio |
          n |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    576,297       50.21       50.21
          1 |    571,542       49.79      100.00
------------+-----------------------------------
      Total |  1,147,839      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[300]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>codebook date
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
date                                                                                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  string (str10)

         unique values:  2,277                    missing &#34;&#34;:  0/1,147,839

              examples:  &#34;2013-11-04&#34;
                         &#34;2015-03-06&#34;
                         &#34;2016-06-01&#34;
                         &#34;2017-09-03&#34;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[301]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen date2 = date(date, &quot;YMD&quot;),after(date)
format date2 %td
drop date
rename date2 date
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[302]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>%head
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>uniquekey</th>
      <th>year</th>
      <th>date</th>
      <th>time</th>
      <th>latenight</th>
      <th>borough</th>
      <th>zipcode</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>mi_latlong</th>
      <th>imput_latlong</th>
      <th>mi_latlong2</th>
      <th>location</th>
      <th>onstreetname</th>
      <th>crossstreetname</th>
      <th>offstreetname</th>
      <th>personsinjured</th>
      <th>personskilled</th>
      <th>pedestriansinjured</th>
      <th>pedestrianskilled</th>
      <th>cyclistinjured</th>
      <th>cyclistkilled</th>
      <th>motoristinjured</th>
      <th>motoristkilled</th>
      <th>contributingfactorvehicle1</th>
      <th>contributingfactorvehicle2</th>
      <th>contributingfactorvehicle3</th>
      <th>contributingfactorvehicle4</th>
      <th>contributingfactorvehicle5</th>
      <th>vehicletypecode1</th>
      <th>vehicletypecode2</th>
      <th>vehicletypecode3</th>
      <th>vehicletypecode4</th>
      <th>vehicletypecode5</th>
      <th>bicyclerelated</th>
      <th>taxirelated</th>
      <th>publicrelated</th>
      <th>dup</th>
      <th>Coordinates</th>
      <th>distance_to_sigInt</th>
      <th>nearest_sigInt</th>
      <th>intersection_id</th>
      <th>intersection</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>3427749</td>
      <td>2016</td>
      <td>24apr2016</td>
      <td>1960-01-01 18:02:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.744896</td>
      <td>-73.770203</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.7448949, -73.7702044)</td>
      <td>.</td>
      <td>.</td>
      <td></td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>Fatigued/Drowsy</td>
      <td>Fatigued/Drowsy</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>24989</td>
      <td>POINT (1047925.420187834 210745.8332306232)</td>
      <td>749</td>
      <td>11247</td>
      <td>11247</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>3474445</td>
      <td>2016</td>
      <td>05jul2016</td>
      <td>1960-01-01 01:30:00</td>
      <td>1</td>
      <td>.</td>
      <td>.</td>
      <td>40.650494</td>
      <td>-74.011772</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.6504919, -74.0117738)</td>
      <td>.</td>
      <td>.</td>
      <td></td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>24989</td>
      <td>POINT (980983.3829843847 176268.9676320423)</td>
      <td>30</td>
      <td>5677</td>
      <td>5677</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>3467416</td>
      <td>2016</td>
      <td>22jun2016</td>
      <td>1960-01-01 12:15:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.705044</td>
      <td>-73.95903</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.7050435, -73.9590323)</td>
      <td>.</td>
      <td>.</td>
      <td></td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>24989</td>
      <td>POINT (995609.2936718578 196145.5996373807)</td>
      <td>111</td>
      <td>7617</td>
      <td>7617</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>2966009</td>
      <td>2014</td>
      <td>11nov2014</td>
      <td>1960-01-01 23:30:00</td>
      <td>1</td>
      <td>.</td>
      <td>.</td>
      <td>40.651398</td>
      <td>-74.010574</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.6513986, -74.0105739)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Driver Inattention/Distraction</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (981315.8004963149 176598.3076968596)</td>
      <td>114</td>
      <td>5675</td>
      <td>5675</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4</td>
      <td>2984443</td>
      <td>2014</td>
      <td>09nov2014</td>
      <td>1960-01-01 06:02:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.700741</td>
      <td>-73.99498</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.7007397, -73.9949795)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Fell Asleep</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>SPORT UTILITY / STATION WAGON</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (985641.9735507105 194575.2794881121)</td>
      <td>459</td>
      <td>4854</td>
      <td>4854</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5</td>
      <td>3378303</td>
      <td>2016</td>
      <td>26jan2016</td>
      <td>1960-01-01 16:27:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.586208</td>
      <td>-73.934166</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.5862074, -73.934164)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>SPORT UTILITY / STATION WAGON</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (1002535.674372012 152854.8011915441)</td>
      <td>780</td>
      <td>6820</td>
      <td>6820</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6</td>
      <td>3035164</td>
      <td>2014</td>
      <td>14aug2014</td>
      <td>1960-01-01 15:55:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.739086</td>
      <td>-73.816101</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.7390852, -73.8160998)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Fatigued/Drowsy</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>UNKNOWN</td>
      <td>VAN</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (1035211.71333712 208599.1167361466)</td>
      <td>283</td>
      <td>10828</td>
      <td>10828</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>7</td>
      <td>3121423</td>
      <td>2012</td>
      <td>16jul2012</td>
      <td>1960-01-01 16:40:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.608223</td>
      <td>-74.129395</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.6082248, -74.1293966)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Turning Improperly</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>SPORT UTILITY / STATION WAGON</td>
      <td>SPORT UTILITY / STATION WAGON</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (948321.9988617403 160894.9525950026)</td>
      <td>754</td>
      <td>12676</td>
      <td>12676</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>8</td>
      <td>3468203</td>
      <td>2016</td>
      <td>18jun2016</td>
      <td>1960-01-01 14:00:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.68877</td>
      <td>-73.999062</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.6887701, -73.999062)</td>
      <td>.</td>
      <td>.</td>
      <td></td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Unspecified</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>24989</td>
      <td>POINT (984510.248463902 190214.0274668361)</td>
      <td>172</td>
      <td>5314</td>
      <td>5314</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>9</td>
      <td>3725939</td>
      <td>2017</td>
      <td>28jul2017</td>
      <td>1960-01-01 14:43:00</td>
      <td>0</td>
      <td>.</td>
      <td>.</td>
      <td>40.83609</td>
      <td>-73.870392</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>(40.83609, -73.87039)</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>Backing Unsafely</td>
      <td>Unspecified</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>PASSENGER VEHICLE</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>.</td>
      <td>POINT (1020114.481894317 243914.0169084446)</td>
      <td>136</td>
      <td>3959</td>
      <td>3959</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[303]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen month = month(date)
gen quarter = quarter(date)
gen collision_count = 1
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[304]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen latenight_collision_count = latenight*collision_count
gen latenight_personsinjured = latenight*personsinjured
gen latenight_personskilled = latenight*personskilled
gen latenight_pedestriansinjured = latenight*pedestriansinjured
gen latenight_pedestrianskilled = latenight*pedestrianskilled
gen latenight_cyclistinjured = latenight*cyclistinjured
gen latenight_cyclistkilled = latenight*cyclistkilled
gen latenight_motoristinjured = latenight*motoristinjured
gen latenight_motoristkilled = latenight*motoristkilled

gen day = (latenight == 0)

gen day_collision_count = day*collision_count
gen day_personsinjured = day*personsinjured
gen day_personskilled = day*personskilled
gen day_pedestriansinjured = day*pedestriansinjured
gen day_pedestrianskilled = day*pedestrianskilled
gen day_cyclistinjured = day*cyclistinjured
gen day_cyclistkilled = day*cyclistkilled
gen day_motoristinjured = day*motoristinjured
gen day_motoristkilled = day*motoristkilled
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)



(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)

(1 missing value generated)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[305]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>global counts collision_count latenight_collision_count day_collision_count
global all_outcome personsinjured personskilled pedestriansinjured pedestrianskilled cyclistinjured cyclistkilled motoristinjured motoristkilled
global late_outcome latenight_personsinjured latenight_personskilled latenight_pedestriansinjured latenight_pedestrianskilled latenight_cyclistinjured latenight_cyclistkilled latenight_motoristinjured latenight_motoristkilled
global day_outcome day_personsinjured day_personskilled day_pedestriansinjured day_pedestrianskilled day_cyclistinjured day_cyclistkilled day_motoristinjured day_motoristkilled
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[306]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>preserve
collapse ///
(sum) &quot;$counts $all_outcome $late_outcome $day_outcome&quot; ///
 , by(intersection_id month year )

//save &quot;..\working_data\collision_monthly.dta&quot;,replace
restore
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>preserve
collapse ///
(sum) &quot;$counts $all_outcome $late_outcome $day_outcome&quot; ///
 , by(intersection_id quarter year)

//save &quot;..\working_data\collision_quarterly.dta&quot;,replace
restore
</pre></div>
</div>
</div>
</div>
<div class="section" id="6.-Set-up-Quarterly-Panel-data">
<h2>6. Set up Quarterly Panel data<a class="headerlink" href="#6.-Set-up-Quarterly-Panel-data" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>stata</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[307]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>clear
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[308]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>cd
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C:\Users\jerem\Box Sync\Policy Evaluation\dofiles
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[309]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// There are 13213 signal intersections
global intersect = 13213+1
global periods_per_year = 4
global obs = $periods_per_year*7*($intersect)

display $obs
set obs $obs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>




369992

number of observations (_N) was 0, now 369,992
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[310]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>egen intersection_id = seq(), from(1) to($intersect)
sort intersection_id
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[311]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>egen quarter = seq(), from(1) to (4) by(intersection_id)
egen year = seq(), from(2012) to (2018) block(4)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[312]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen quarterly = yq(year,quarter)
format quarterly %tq
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[313]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>//These are outside of the range of our data
drop if quarter &lt;= 2 &amp; year == 2012
drop if quarter &gt;= 4 &amp; year == 2018
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(26,428 observations deleted)

(13,214 observations deleted)
</pre></div></div>
</div>
<div class="section" id="6.a.-Merge-in-Intersection-Data">
<h3>6.a. Merge in Intersection Data<a class="headerlink" href="#6.a.-Merge-in-Intersection-Data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[314]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Intersection level data
mmerge intersection_id using &quot;..\working_data\signal_intersection.dta&quot;, ///
type(n:1) ///
unmatched(using) ///
umatch(intersection_id)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


-------------------------------------------------------------------------------
merge specs          |
       matching type | n:1
  mv&#39;s on match vars | none
  unmatched obs from | using
---------------------+---------------------------------------------------------
  master        file | &lt;data in memory not named&gt;
                 obs | 330350
                vars |      4
          match vars | intersection_id  (not a key)
  -------------------+---------------------------------------------------------
  using         file | ..\working_data\signal_intersection.dta
                 obs |  13213
                vars |     38
          match vars | intersection_id  (key)
---------------------+---------------------------------------------------------
variable intersection_id does not uniquely identify observations in the master data
result          file | &lt;data in memory not named&gt;
                 obs | 330325
                vars |     43  (including _merge)
         ------------+---------------------------------------------------------
              _merge | 330325  obs both in master and using data      (code==3)
-------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[315]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>describe
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Contains data
  obs:       330,325
 vars:            42
 size:   153,270,800
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
intersection_id int     %8.0g
quarter         byte    %8.0g
year            int     %8.0g
quarterly       int     %tq
index           int     %12.0g
y               double  %10.0g
x               double  %10.0g
st1_name        str31   %31s
st2_name        str32   %32s
st3_name        str35   %35s
st4_name        str36   %36s
dup             byte    %8.0g
Coordinates     str42   %42s
distance_to_L~S int     %12.0g
nearest_LPIS    int     %12.0g
date_insta      str10   %10s
distance_to_S~t int     %12.0g
nearest_Street  long    %12.0g
Number_Tra      str4    %4s
Number_Par      str4    %4s
Number_Tot      str4    %4s
TrafDir         str4    %4s
distance_to_Sch int     %12.0g
nearest_Sch     long    %10.0g
distance_to_LTC long    %12.0g
nearest_LTC     int     %12.0g
treatment_      str80   %80s
completion      str10   %10s
distance_to_S~o long    %12.0g
nearest_StImpro int     %12.0g
DateComplt      str10   %10s
SIPProjTyp      str53   %53s
distance_to_b~e int     %12.0g
nearest_biker~e int     %10.0g
distance_to_t~e int     %12.0g
nearest_truck~e long    %12.0g
bname           str13   %13s
distance_to_p~s int     %12.0g
nearest_prior~s int     %12.0g
Name            str26   %26s
seniors_ID      byte    %10.0g
_merge          byte    %32.0g     __MERGE
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sorted by:
     Note: Dataset has changed since last saved.
</pre></div></div>
</div>
</div>
<div class="section" id="6.b.-Create-borough-dummies">
<h3>6.b. Create borough dummies<a class="headerlink" href="#6.b.-Create-borough-dummies" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[316]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab bname,m
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

        bname |      Freq.     Percent        Cum.
--------------+-----------------------------------
        Bronx |     42,600       12.90       12.90
     Brooklyn |    117,400       35.54       48.44
    Manhattan |     71,775       21.73       70.17
       Queens |     82,800       25.07       95.23
Staten Island |     15,650        4.74       99.97
          nan |        100        0.03      100.00
--------------+-----------------------------------
        Total |    330,325      100.00
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[317]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen bronx = (bname == &quot;Bronx&quot;)
gen brooklyn = (bname == &quot;Brooklyn&quot;)
gen manhattan = (bname == &quot;Manhattan&quot;)
gen queens = (bname == &quot;Queens&quot;)
gen statenisland = (bname == &quot;Staten Island&quot;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="6.c.-Nearest-Bike-Route">
<h3>6.c. Nearest Bike Route<a class="headerlink" href="#6.c.-Nearest-Bike-Route" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[320]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>destring nearest_bikeroute,replace
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
nearest_bikeroute already numeric; no replace
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[321]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>mmerge nearest_bikeroute using &quot;..\working_data\bike_routes_2263.dta&quot;, ///
type(n:1) ///
unmatched(master) ///
umatch(objectid_1) ///
ukeep(date_instd tf_facilit)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


-------------------------------------------------------------------------------
merge specs          |
       matching type | n:1
  mv&#39;s on match vars | none
  unmatched obs from | master
---------------------+---------------------------------------------------------
  master        file | &lt;data in memory not named&gt;
                 obs | 330325
                vars |     46
          match vars | nearest_bikeroute  (not a key)
  -------------------+---------------------------------------------------------
  using         file | ..\working_data\bike_routes_2263.dta
                 obs |  14980
                vars |      3  (selection via udrop/ukeep)
          match vars | objectid_1  (key)
---------------------+---------------------------------------------------------
variable nearest_bikeroute does not uniquely identify observations in the master data
result          file | &lt;data in memory not named&gt;
                 obs | 330325
                vars |     50  (including _merge)
         ------------+---------------------------------------------------------
              _merge | 330325  obs both in master and using data      (code==3)
-------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[322]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen bike_route_install_dt = date(date_instd, &quot;YMD&quot;), after(date_instd)
format bike_route_install_dt %td
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[323]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum bike_route_install_dt, format
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bike_route~t |    330,325   24nov2002    7771.114  01jan1900  23dec2016
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[324]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen bike_route_install_mt = mofd(bike_route_install_dt)
format bike_route_install_mt %tm
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[325]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum bike_route_install_mt, format
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bike_rout~mt |    330,325   2002m11    255.2326   1900m1  2016m12
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[326]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen bike_route_install_qt = qofd(bike_route_install_dt)
format bike_route_install_qt %tq
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[327]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum bike_route_install_qt, format
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
bike_rout~qt |    330,325   2002q4    85.00089  1900q1  2016q4
</pre></div></div>
</div>
<div class="section" id="Determine-if-collision-occured-on-bike-route">
<h4>Determine if collision occured on bike route<a class="headerlink" href="#Determine-if-collision-occured-on-bike-route" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[328]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_bikeroute, detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                    distance_to_bikeroute
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            1              0       Obs             330,325
25%            3              0       Sum of Wgt.     330,325

50%          537                      Mean           1023.112
                        Largest       Std. Dev.      1365.944
75%         1416           8907
90%         2871           8907       Variance        1865802
95%         4039           8907       Skewness        2.00231
99%         6101           8907       Kurtosis       7.320251
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[329]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_bikeroute if distance_to_bikeroute &lt; r(p50) , detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                    distance_to_bikeroute
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs             165,025
25%            1              0       Sum of Wgt.     165,025

50%            3                      Mean           122.9515
                        Largest       Std. Dev.      176.5845
75%          262            536
90%          447            536       Variance       31182.09
95%          507            536       Skewness       1.105402
99%          530            536       Kurtosis        2.69221
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[330]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Time invariant bike route indicator
gen bike_route_ever = distance_to_bikeroute &lt;= 3
label variable bike_route_ever &quot;Indicates that bike route passes through this intersection (&lt;3 ft)&quot;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[331]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab bike_route_ever
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

  Indicates |
  that bike |
      route |
     passes |
    through |
       this |
intersectio |
  n (&lt;3 ft) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    245,200       74.23       74.23
          1 |     85,125       25.77      100.00
------------+-----------------------------------
      Total |    330,325      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[333]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Time-variant bike route indicator
gen bike_route_tv = 0
replace bike_route_tv = 1 if quarterly &gt;= bike_route_install_qt &amp; bike_route_ever == 1
label variable bike_route_tv &quot;Indicates that bike route passes through this intersection timevarient(&lt;3 ft)&quot;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>



(74,140 real changes made)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[334]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab bike_route_tv
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

  Indicates |
  that bike |
      route |
     passes |
    through |
       this |
intersectio |
          n |
timevarient |
    (&lt;3 ft) |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    256,185       77.56       77.56
          1 |     74,140       22.44      100.00
------------+-----------------------------------
      Total |    330,325      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[347]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab bike_route_tv year
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

 Indicates |
 that bike |
     route |
    passes |
   through |
      this |
intersecti |
        on |
timevarien |                                     year
  t(&lt;3 ft) |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    21,681     42,808     41,981     41,054     40,005     39,232     29,424 |   256,185
         1 |     4,745     10,044     10,871     11,798     12,847     13,620     10,215 |    74,140
-----------+-----------------------------------------------------------------------------+----------
     Total |    26,426     52,852     52,852     52,852     52,852     52,852     39,639 |   330,325
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="6.d.-Left-Turn-Calming-Intervention">
<h3>6.d. Left Turn Calming Intervention<a class="headerlink" href="#6.d.-Left-Turn-Calming-Intervention" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[335]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>rename treatment_ left_turn_treatment
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[336]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen left_turn_install_dt = date(completion, &quot;YMD&quot;), after(completion)
format left_turn_install_dt %td
gen int left_turn_install_mt = mofd(left_turn_install_dt), after(left_turn_install_dt)
format left_turn_install_mt %tm
gen int left_turn_install_qt = qofd(left_turn_install_dt), after(left_turn_install_dt)
format left_turn_install_qt %tq
</pre></div>
</div>
</div>
<div class="section" id="Matching-intersection-to-closest-left-turn-calming-intervention">
<h4>Matching intersection to closest left turn calming intervention<a class="headerlink" href="#Matching-intersection-to-closest-left-turn-calming-intervention" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[337]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>egen double left_turn_min = min(distance_to_LTC), by(nearest_LTC)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[338]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_left_turn_ever = .
replace flag_left_turn_ever = 1 if left_turn_min == distance_to_LTC
replace flag_left_turn_ever = 0 if mi(flag_left_turn_ever)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(330,325 missing values generated)

(5,800 real changes made)

(324,525 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[339]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_left_turn = flag_left_turn_ever
replace flag_left_turn = 0 if flag_left_turn == 1 &amp; quarterly &lt; left_turn_install_qt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


(4,359 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[345]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_left_turn year
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

flag_left_ |                                     year
      turn |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    26,426     52,852     52,852     52,852     52,676     52,266     38,960 |   328,884
         1 |         0          0          0          0        176        586        679 |     1,441
-----------+-----------------------------------------------------------------------------+----------
     Total |    26,426     52,852     52,852     52,852     52,852     52,852     39,639 |   330,325
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="6.e.-Street-Improvement-Project-intervention">
<h3>6.e. Street Improvement Project intervention<a class="headerlink" href="#6.e.-Street-Improvement-Project-intervention" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[340]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>rename SIPProjTyp street_improv_treatment
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[341]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen street_improv_install_dt = date(DateComplt, &quot;YMD&quot;), after(DateComplt)
format street_improv_install_dt %td
gen int street_improv_install_mt = mofd(street_improv_install_dt), after(street_improv_install_dt)
format street_improv_install_mt %tm
gen int street_improv_install_qt = qofd(street_improv_install_dt), after(street_improv_install_dt)
format street_improv_install_qt %tq
</pre></div>
</div>
</div>
<div class="section" id="Matching-intersection-to-closest-street-improvement-project">
<h4>Matching intersection to closest street improvement project<a class="headerlink" href="#Matching-intersection-to-closest-street-improvement-project" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[342]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>egen double street_improv_min = min(distance_to_StImpro), by(nearest_StImpro)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[343]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_street_improv_ever = .
replace flag_street_improv_ever = 1 if street_improv_min == distance_to_StImpro
replace flag_street_improv_ever = 0 if mi(flag_street_improv_ever)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(330,325 missing values generated)

(9,125 real changes made)

(321,200 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[344]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_street_improv = flag_street_improv_ever
replace flag_street_improv = 0 if flag_street_improv == 1 &amp; quarterly &lt; street_improv_install_qt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


(4,592 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[346]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_street_improv year
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

flag_stree |                                     year
  t_improv |      2012       2013       2014       2015       2016       2017       2018 |     Total
-----------+-----------------------------------------------------------------------------+----------
         0 |    26,297     52,556     52,449     52,234     51,957     51,704     38,595 |   325,792
         1 |       129        296        403        618        895      1,148      1,044 |     4,533
-----------+-----------------------------------------------------------------------------+----------
     Total |    26,426     52,852     52,852     52,852     52,852     52,852     39,639 |   330,325
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="6.f.-Leading-Pedestrian-Interval-Signal">
<h3>6.f. Leading Pedestrian Interval Signal<a class="headerlink" href="#6.f.-Leading-Pedestrian-Interval-Signal" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[348]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen LPIS_install_dt = date(date_insta, &quot;YMD&quot;)
format LPIS_install_dt %td
gen int LPIS_install_mt = mofd(LPIS_install_dt), after(LPIS_install_dt)
format LPIS_install_mt %tm
gen int LPIS_install_qt = qofd(LPIS_install_dt), after(LPIS_install_mt)
format LPIS_install_qt %tq
gen LPIS_install_yr = year(LPIS_install_dt), after(LPIS_install_qt)
</pre></div>
</div>
</div>
<div class="section" id="Matching-intersection-to-closest-leading-pedestrian-interval-signal">
<h4>Matching intersection to closest leading pedestrian interval signal<a class="headerlink" href="#Matching-intersection-to-closest-leading-pedestrian-interval-signal" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[349]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>egen double LPIS_min = min(distance_to_LPIS), by(nearest_LPIS)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[350]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_LPIS_ever = .
replace flag_LPIS_ever = 1 if LPIS_min == distance_to_LPIS
replace flag_LPIS_ever = 0 if mi(flag_LPIS_ever)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(330,325 missing values generated)

(72,875 real changes made)

(257,450 real changes made)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[351]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_LPIS = flag_LPIS_ever
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[356]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Replace with indicator with 0 if quarter was before LPIS installation
replace flag_LPIS = 0 if flag_LPIS == 1 &amp; quarterly &lt; LPIS_install_qt
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(47,593 real changes made)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[368]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>label variable flag_LPIS &quot;Indicates the intersection at the time they became an LPIS intervention&quot;
label variable flag_LPIS_ever &quot;Indicates the intersection if they ever received LPIS intervention&quot;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Problem:-Certain-LPIs-intersections-had-been-install-before-collision-data">
<h4>Problem: Certain LPIs intersections had been install before collision data<a class="headerlink" href="#Problem:-Certain-LPIs-intersections-had-been-install-before-collision-data" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[357]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum quarterly, detail format
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                          quarterly
-------------------------------------------------------------
      Percentiles      Smallest
 1%    2012q3      2012q3
 5%    2012q4      2012q3
10%    2013q1      2012q3       Obs             330,325
25%    2014q1      2012q3       Sum of Wgt.     330,325

50%    2015q3                      Mean          2015q3
                        Largest       Std. Dev.      7.211113
75%    2017q1      2018q3
90%    2018q1      2018q3       Variance       52.00016
95%    2018q2      2018q3       Skewness              0
99%    2018q3      2018q3       Kurtosis       1.796154
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[358]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum LPIS_install_qt, detail format
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                       LPIS_install_qt
-------------------------------------------------------------
      Percentiles      Smallest
 1%    1899q4      1899q4
 5%    2004q1      1899q4
10%    2013q2      1899q4       Obs             330,325
25%    2015q4      1899q4       Sum of Wgt.     330,325

50%    2016q3                      Mean          2014q2
                        Largest       Std. Dev.       51.7974
75%    2017q3      2018q3
90%    2018q2      2018q3       Variance       2682.971
95%    2018q3      2018q3       Skewness      -7.818992
99%    2018q3      2018q3       Kurtosis       68.19259
</pre></div></div>
</div>
<p>We will remove intersections that cannot be analyzed because LPIs was implemented before 01jul2012</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[359]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_LPIS if LPIS_install_qt &lt; tq(2013q1)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

  flag_LPIS |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     26,477       82.42       82.42
          1 |      5,648       17.58      100.00
------------+-----------------------------------
      Total |     32,125      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[360]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab intersection_id if LPIS_install_qt &lt; tq(2013q1) &amp; flag_LPIS_ever == 1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

intersectio |
       n_id |      Freq.     Percent        Cum.
------------+-----------------------------------
          7 |         25        0.44        0.44
          8 |         25        0.44        0.88
         17 |         25        0.44        1.33
         57 |         25        0.44        1.77
         58 |         25        0.44        2.21
         61 |         25        0.44        2.65
         83 |         25        0.44        3.10
        109 |         25        0.44        3.54
        149 |         25        0.44        3.98
        151 |         25        0.44        4.42
        161 |         25        0.44        4.87
        230 |         25        0.44        5.31
        231 |         25        0.44        5.75
        238 |         25        0.44        6.19
        239 |         25        0.44        6.64
        243 |         25        0.44        7.08
        255 |         25        0.44        7.52
        256 |         25        0.44        7.96
        280 |         25        0.44        8.41
        282 |         25        0.44        8.85
        286 |         25        0.44        9.29
        317 |         25        0.44        9.73
        333 |         25        0.44       10.18
        449 |         25        0.44       10.62
        454 |         25        0.44       11.06
        468 |         25        0.44       11.50
        511 |         25        0.44       11.95
        547 |         25        0.44       12.39
        550 |         25        0.44       12.83
        557 |         25        0.44       13.27
        560 |         25        0.44       13.72
        567 |         25        0.44       14.16
        582 |         25        0.44       14.60
        601 |         25        0.44       15.04
        605 |         25        0.44       15.49
        606 |         25        0.44       15.93
        620 |         25        0.44       16.37
        624 |         25        0.44       16.81
        628 |         25        0.44       17.26
        629 |         25        0.44       17.70
        633 |         25        0.44       18.14
        642 |         25        0.44       18.58
        661 |         25        0.44       19.03
        676 |         25        0.44       19.47
        692 |         25        0.44       19.91
        693 |         25        0.44       20.35
        724 |         25        0.44       20.80
        800 |         25        0.44       21.24
        813 |         25        0.44       21.68
        827 |         25        0.44       22.12
        858 |         25        0.44       22.57
        862 |         25        0.44       23.01
        903 |         25        0.44       23.45
        914 |         25        0.44       23.89
        940 |         25        0.44       24.34
        949 |         25        0.44       24.78
        964 |         25        0.44       25.22
        981 |         25        0.44       25.66
        984 |         25        0.44       26.11
        986 |         25        0.44       26.55
        993 |         25        0.44       26.99
       1066 |         25        0.44       27.43
       1070 |         25        0.44       27.88
       1092 |         25        0.44       28.32
       1101 |         25        0.44       28.76
       1140 |         25        0.44       29.20
       1188 |         25        0.44       29.65
       1195 |         25        0.44       30.09
       1201 |         25        0.44       30.53
       1202 |         25        0.44       30.97
       1205 |         25        0.44       31.42
       1207 |         25        0.44       31.86
       1211 |         25        0.44       32.30
       1221 |         25        0.44       32.74
       1228 |         25        0.44       33.19
       1235 |         25        0.44       33.63
       1237 |         25        0.44       34.07
       1287 |         25        0.44       34.51
       1290 |         25        0.44       34.96
       1321 |         25        0.44       35.40
       1372 |         25        0.44       35.84
       1420 |         25        0.44       36.28
       1448 |         25        0.44       36.73
       1450 |         25        0.44       37.17
       1451 |         25        0.44       37.61
       1461 |         25        0.44       38.05
       1467 |         25        0.44       38.50
       1486 |         25        0.44       38.94
       1487 |         25        0.44       39.38
       1500 |         25        0.44       39.82
       1506 |         25        0.44       40.27
       1507 |         25        0.44       40.71
       1532 |         25        0.44       41.15
       1551 |         25        0.44       41.59
       1558 |         25        0.44       42.04
       1563 |         25        0.44       42.48
       1574 |         25        0.44       42.92
       1575 |         25        0.44       43.36
       1663 |         25        0.44       43.81
       1664 |         25        0.44       44.25
       1730 |         25        0.44       44.69
       1731 |         25        0.44       45.13
       1736 |         25        0.44       45.58
       1742 |         25        0.44       46.02
       1759 |         25        0.44       46.46
       1760 |         25        0.44       46.90
       1777 |         25        0.44       47.35
       1788 |         25        0.44       47.79
       1795 |         25        0.44       48.23
       1826 |         25        0.44       48.67
       1827 |         25        0.44       49.12
       1838 |         25        0.44       49.56
       1845 |         25        0.44       50.00
       1863 |         25        0.44       50.44
       1898 |         25        0.44       50.88
       1912 |         25        0.44       51.33
       1914 |         25        0.44       51.77
       1916 |         25        0.44       52.21
       1923 |         25        0.44       52.65
       1940 |         25        0.44       53.10
       1941 |         25        0.44       53.54
       2025 |         25        0.44       53.98
       2045 |         25        0.44       54.42
       2102 |         25        0.44       54.87
       2217 |         25        0.44       55.31
       2321 |         25        0.44       55.75
       2381 |         25        0.44       56.19
       2387 |         25        0.44       56.64
       2487 |         25        0.44       57.08
       2510 |         25        0.44       57.52
       2539 |         25        0.44       57.96
       2667 |         25        0.44       58.41
       2670 |         25        0.44       58.85
       2673 |         25        0.44       59.29
       2825 |         25        0.44       59.73
       3005 |         25        0.44       60.18
       3140 |         25        0.44       60.62
       3455 |         25        0.44       61.06
       3561 |         25        0.44       61.50
       4090 |         25        0.44       61.95
       4340 |         25        0.44       62.39
       4701 |         25        0.44       62.83
       4735 |         25        0.44       63.27
       5042 |         25        0.44       63.72
       5054 |         25        0.44       64.16
       5276 |         25        0.44       64.60
       5278 |         25        0.44       65.04
       5285 |         25        0.44       65.49
       5314 |         25        0.44       65.93
       5345 |         25        0.44       66.37
       5346 |         25        0.44       66.81
       5348 |         25        0.44       67.26
       5363 |         25        0.44       67.70
       5385 |         25        0.44       68.14
       5398 |         25        0.44       68.58
       5418 |         25        0.44       69.03
       5429 |         25        0.44       69.47
       5430 |         25        0.44       69.91
       5467 |         25        0.44       70.35
       5514 |         25        0.44       70.80
       5566 |         25        0.44       71.24
       5638 |         25        0.44       71.68
       5685 |         25        0.44       72.12
       5708 |         25        0.44       72.57
       5761 |         25        0.44       73.01
       5805 |         25        0.44       73.45
       5827 |         25        0.44       73.89
       6030 |         25        0.44       74.34
       6152 |         25        0.44       74.78
       6153 |         25        0.44       75.22
       6179 |         25        0.44       75.66
       6255 |         25        0.44       76.11
       6318 |         25        0.44       76.55
       6428 |         25        0.44       76.99
       6751 |         25        0.44       77.43
       6807 |         25        0.44       77.88
       6822 |         25        0.44       78.32
       6868 |         25        0.44       78.76
       7316 |         25        0.44       79.20
       7506 |         25        0.44       79.65
       9193 |         25        0.44       80.09
       9299 |         25        0.44       80.53
       9516 |         25        0.44       80.97
       9821 |         25        0.44       81.42
       9830 |         25        0.44       81.86
       9831 |         25        0.44       82.30
       9832 |         25        0.44       82.74
       9833 |         25        0.44       83.19
       9834 |         25        0.44       83.63
       9835 |         25        0.44       84.07
       9836 |         25        0.44       84.51
       9837 |         25        0.44       84.96
       9838 |         25        0.44       85.40
       9839 |         25        0.44       85.84
       9840 |         25        0.44       86.28
       9841 |         25        0.44       86.73
       9842 |         25        0.44       87.17
       9843 |         25        0.44       87.61
       9844 |         25        0.44       88.05
       9845 |         25        0.44       88.50
       9846 |         25        0.44       88.94
       9942 |         25        0.44       89.38
       9993 |         25        0.44       89.82
      10016 |         25        0.44       90.27
      10037 |         25        0.44       90.71
      10040 |         25        0.44       91.15
      10190 |         25        0.44       91.59
      10309 |         25        0.44       92.04
      10456 |         25        0.44       92.48
      10576 |         25        0.44       92.92
      10676 |         25        0.44       93.36
      10818 |         25        0.44       93.81
      10825 |         25        0.44       94.25
      11024 |         25        0.44       94.69
      11027 |         25        0.44       95.13
      11268 |         25        0.44       95.58
      11284 |         25        0.44       96.02
      11358 |         25        0.44       96.46
      11719 |         25        0.44       96.90
      12266 |         25        0.44       97.35
      12606 |         25        0.44       97.79
      12627 |         25        0.44       98.23
      12655 |         25        0.44       98.67
      12772 |         25        0.44       99.12
      12891 |         25        0.44       99.56
      12895 |         25        0.44      100.00
------------+-----------------------------------
      Total |      5,650      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[361]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>drop if LPIS_install_qt &lt; tq(2013q1) &amp; flag_LPIS_ever == 1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(5,650 observations deleted)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="6.g.-Safe-Streets-for-Seniors">
<h3>6.g. Safe Streets for Seniors<a class="headerlink" href="#6.g.-Safe-Streets-for-Seniors" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[369]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>codebook Name
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Name                                                                                                                                                                 (unlabeled)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

                  type:  string (str26)

         unique values:  42                       missing &#34;&#34;:  0/324,675

              examples:  &#34;nan&#34;
                         &#34;nan&#34;
                         &#34;nan&#34;
                         &#34;nan&#34;

               warning:  variable has embedded blanks
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[370]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab Name
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                      Name |      Freq.     Percent        Cum.
---------------------------+-----------------------------------
                   Astoria |        775        0.24        0.24
                Bath Beach |        975        0.30        0.54
                 Bay Ridge |      1,700        0.52        1.06
        Bedford Stuyvesant |      4,600        1.42        2.48
               Bensonhurst |      2,475        0.76        3.24
              Borough Park |      5,000        1.54        4.78
            Brighton Beach |        225        0.07        4.85
               Brownsville |      5,100        1.57        6.42
        Chelsea/9th Avenue |      1,900        0.59        7.01
                 Chinatown |        475        0.15        7.15
           Corona Elmhurst |      7,125        2.19        9.35
            East Concourse |        450        0.14        9.49
             East Flatbush |        600        0.18        9.67
               East Harlem |      2,625        0.81       10.48
              East Village |        125        0.04       10.52
                  Flatbush |      1,225        0.38       10.90
                  Flushing |        700        0.22       11.11
Fordham/University Heights |        600        0.18       11.30
              Forest Hills |      1,200        0.37       11.67
                Greenpoint |        450        0.14       11.80
          Hamilton Heights |      1,050        0.32       12.13
Highbridge/Lower Concourse |      3,600        1.11       13.24
           Jackson Heights |      1,150        0.35       13.59
             Jamaica Hills |        125        0.04       13.63
     Kings Bay - Gerritsen |      1,875        0.58       14.21
               Kingsbridge |        600        0.18       14.39
   Lenox Hill - Turtle Bay |      3,225        0.99       15.38
           Lower East Side |        800        0.25       15.63
          Manhattan Valley |      3,175        0.98       16.61
 Middle Village - Glendale |      1,175        0.36       16.97
                   Midwood |        300        0.09       17.06
                Mott Haven |      1,075        0.33       17.39
 New Dorp/Hyland Boulevard |        200        0.06       17.46
            Pelham Gardens |         75        0.02       17.48
                 Rego Park |        250        0.08       17.56
            Sheepshead Bay |        750        0.23       17.79
               South Beach |        100        0.03       17.82
                 Sunnyside |        625        0.19       18.01
           Upper West Side |      1,675        0.52       18.53
        Washington Heights |      1,375        0.42       18.95
                 Yorkville |      2,875        0.89       19.84
                       nan |    260,275       80.16      100.00
---------------------------+-----------------------------------
                     Total |    324,675      100.00
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[371]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_seniors = (strpos(Name, &quot;nan&quot;) == 0)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[373]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_seniors
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

flag_senior |
          s |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    260,275       80.16       80.16
          1 |     64,400       19.84      100.00
------------+-----------------------------------
      Total |    324,675      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[374]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_seniors flag_LPIS
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

           |     Indicates the
           |  intersection at the
           |  time they became an
flag_senio |   LPIS intervention
        rs |         0          1 |     Total
-----------+----------------------+----------
         0 |   246,705     13,570 |   260,275
         1 |    58,336      6,064 |    64,400
-----------+----------------------+----------
     Total |   305,041     19,634 |   324,675
</pre></div></div>
</div>
</div>
<div class="section" id="6.h.-Priority-Intersection">
<h3>6.h. Priority Intersection<a class="headerlink" href="#6.h.-Priority-Intersection" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[377]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_p*, detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                 distance_to_priorityinters
-------------------------------------------------------------
      Percentiles      Smallest
 1%            3              0
 5%          372              0
10%          640              0       Obs             324,675
25%         1110              0       Sum of Wgt.     324,675

50%         1991                      Mean           2603.942
                        Largest       Std. Dev.      2534.222
75%         3221          28481
90%         4978          28481       Variance        6422279
95%         6561          28481       Skewness        3.67198
99%        13842          28481       Kurtosis       23.89315
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[376]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_priorityinters = (distance_to_priorityinters &lt; 10)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[379]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_priorityinters
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

flag_priori |
   tyinters |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    319,200       98.31       98.31
          1 |      5,475        1.69      100.00
------------+-----------------------------------
      Total |    324,675      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[378]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_priorityinters flag_LPIS
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

           |     Indicates the
           |  intersection at the
           |  time they became an
flag_prior |   LPIS intervention
 ityinters |         0          1 |     Total
-----------+----------------------+----------
         0 |   300,649     18,551 |   319,200
         1 |     4,392      1,083 |     5,475
-----------+----------------------+----------
     Total |   305,041     19,634 |   324,675
</pre></div></div>
</div>
</div>
<div class="section" id="6.i.-School-intersection/crossing">
<h3>6.i. School intersection/crossing<a class="headerlink" href="#6.i.-School-intersection/crossing" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[380]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sum distance_to_Sch,detail
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                       distance_to_Sch
-------------------------------------------------------------
      Percentiles      Smallest
 1%          125             17
 5%          197             17
10%          246             17       Obs             324,675
25%          425             17       Sum of Wgt.     324,675

50%          692                      Mean           822.7985
                        Largest       Std. Dev.      612.1056
75%         1055          10685
90%         1511          10685       Variance       374673.3
95%         1872          10685       Skewness       3.568631
99%         2871          10685       Kurtosis        35.5307
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[381]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_school = (distance_to_Sch &lt; 200)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[382]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_school
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

flag_school |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    307,775       94.79       94.79
          1 |     16,900        5.21      100.00
------------+-----------------------------------
      Total |    324,675      100.00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[383]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>tab flag_school flag_LPIS
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

           |     Indicates the
           |  intersection at the
           |  time they became an
flag_schoo |   LPIS intervention
         l |         0          1 |     Total
-----------+----------------------+----------
         0 |   289,690     18,085 |   307,775
         1 |    15,351      1,549 |    16,900
-----------+----------------------+----------
     Total |   305,041     19,634 |   324,675
</pre></div></div>
</div>
</div>
<div class="section" id="6.j.-Decay-effect">
<h3>6.j. Decay effect<a class="headerlink" href="#6.j.-Decay-effect" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[362]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sort intersection_id quarterly
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[363]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>bysort intersection_id: gen flag_LPIS_1yr = 1 if quarterly == (LPIS_install_qt+1)
bysort intersection_id: replace flag_LPIS_1yr = 1 if quarterly == (LPIS_install_qt+2)
bysort intersection_id: replace flag_LPIS_1yr = 1 if quarterly == (LPIS_install_qt+3)
bysort intersection_id: replace flag_LPIS_1yr = 1 if quarterly == (LPIS_install_qt+4)
replace flag_LPIS_1yr = 0 if missing(flag_LPIS_1yr)
replace flag_LPIS_1yr = 0 if flag_LPIS_ever == 0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(313,505 missing values generated)

(10,265 real changes made)

(9,357 real changes made)

(8,784 real changes made)

(285,099 real changes made)

(30,934 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[364]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>bysort intersection_id: gen flag_LPIS_2yr = 1 if quarterly == (LPIS_install_qt+5)
bysort intersection_id: replace flag_LPIS_2yr = 1 if quarterly == (LPIS_install_qt+6)
bysort intersection_id: replace flag_LPIS_2yr = 1 if quarterly == (LPIS_install_qt+7)
bysort intersection_id: replace flag_LPIS_2yr = 1 if quarterly == (LPIS_install_qt+8)
replace flag_LPIS_2yr = 0 if missing(flag_LPIS_2yr)
replace flag_LPIS_2yr = 0 if flag_LPIS_ever == 0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(316,621 missing values generated)

(7,091 real changes made)

(6,147 real changes made)

(5,611 real changes made)

(297,772 real changes made)

(21,441 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[365]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>bysort intersection_id: gen flag_LPIS_2yrup = 1 if quarterly == (LPIS_install_qt+5)
bysort intersection_id: replace flag_LPIS_2yrup = 1 if flag_LPIS_2yrup[_n-1] == 1
replace flag_LPIS_2yrup = 0 if missing(flag_LPIS_2yrup)
replace flag_LPIS_2yrup = 0 if flag_LPIS_ever == 0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(316,621 missing values generated)

(35,482 real changes made)

(281,139 real changes made)

(35,233 real changes made)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[366]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>bysort intersection_id: gen flag_LPIS_3yrup = 1 if quarterly == (LPIS_install_qt+9)
bysort intersection_id: replace flag_LPIS_3yrup = 1 if flag_LPIS_3yrup[_n-1] == 1
replace flag_LPIS_3yrup = 0 if missing(flag_LPIS_3yrup)
replace flag_LPIS_3yrup = 0 if flag_LPIS_ever == 0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(320,275 missing values generated)

(14,683 real changes made)

(305,592 real changes made)

(16,242 real changes made)
</pre></div></div>
</div>
</div>
<div class="section" id="6.k.-Panel-is-strongly-balanced">
<h3>6.k. Panel is strongly balanced<a class="headerlink" href="#6.k.-Panel-is-strongly-balanced" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[367]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>duplicates report intersection_id
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Duplicates in terms of intersection_id

--------------------------------------
   copies | observations       surplus
----------+---------------------------
       25 |       324675        311688
--------------------------------------
</pre></div></div>
</div>
</div>
<div class="section" id="6.l.-Merge-outcomes-data">
<h3>6.l. Merge outcomes data<a class="headerlink" href="#6.l.-Merge-outcomes-data" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[384]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Outcomes data
mmerge quarter year intersection_id using &quot;..\working_data\collision_quarterly.dta&quot;, ///
type(1:1) ///
unmatched(master)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

-------------------------------------------------------------------------------
merge specs          |
       matching type | 1:1
  mv&#39;s on match vars | none
  unmatched obs from | master
---------------------+---------------------------------------------------------
  master        file | &lt;data in memory not named&gt;
                 obs | 324675
                vars |     79
          match vars | quarter year intersection_id  (key)
  -------------------+---------------------------------------------------------
  using         file | ..\working_data\collision_quarterly.dta
                 obs | 195341
                vars |     30
          match vars | quarter year intersection_id  (key)
---------------------+---------------------------------------------------------
result          file | &lt;data in memory not named&gt;
                 obs | 324675
                vars |    108  (including _merge)
         ------------+---------------------------------------------------------
              _merge | 133939  obs only in master data                (code==1)
                     | 190736  obs both in master and using data      (code==3)
-------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="line-block">
<div class="line">Reason that we did not match every obs from using is:</div>
<div class="line">1. That we droped intersections in the intersection level data merge process 2. Certain LPIS junctions have been installed before the collisions datasets begin</div>
</div>
</div>
<div class="section" id="6.m.-Fill-in-missing-information">
<h3>6.m. Fill in missing information<a class="headerlink" href="#6.m.-Fill-in-missing-information" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[385]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>// Fill in &#39;0&#39; for intersection quarter year that did not have collisions
replace personsinjured = 0 if _merge == 1
replace personskilled = 0 if _merge == 1
replace pedestriansinjured = 0 if _merge == 1
replace pedestrianskilled = 0 if _merge == 1
replace cyclistinjured = 0 if _merge == 1
replace cyclistkilled = 0 if _merge == 1
replace motoristinjured = 0 if _merge == 1
replace motoristkilled = 0 if _merge == 1
replace collision_count = 0 if mi(collision_count)

replace latenight_personsinjured = 0 if _merge == 1
replace latenight_personskilled = 0 if _merge == 1
replace latenight_pedestriansinjured = 0 if _merge == 1
replace latenight_pedestrianskilled = 0 if _merge == 1
replace latenight_cyclistinjured = 0 if _merge == 1
replace latenight_cyclistkilled = 0 if _merge == 1
replace latenight_motoristinjured = 0 if _merge == 1
replace latenight_motoristkilled = 0 if _merge == 1
replace latenight_collision_count = 0 if mi(latenight_collision_count)

replace day_personsinjured = 0 if _merge == 1
replace day_personskilled = 0 if _merge == 1
replace day_pedestriansinjured = 0 if _merge == 1
replace day_pedestrianskilled = 0 if _merge == 1
replace day_cyclistinjured = 0 if _merge == 1
replace day_cyclistkilled = 0 if _merge == 1
replace day_motoristinjured = 0 if _merge == 1
replace day_motoristkilled = 0 if _merge == 1
replace day_collision_count = 0 if mi(day_collision_count)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)

(133,939 real changes made)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[387]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>gen flag_collision = collision_count &gt; 0
gen latenight_flag_collision = latenight_collision_count &gt; 0
gen day_flag_collision = day_collision_count &gt; 0
</pre></div>
</div>
</div>
<p>Label outcomes variables</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[388]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>label variable personsinjured &quot;No. of persons injured during that month&quot;
label variable personskilled &quot;No. of persons killed during that month&quot;
label variable pedestriansinjured &quot;No. of pedestrians injured during that month&quot;
label variable pedestrianskilled &quot;No. of pedestrians killed during that month&quot;
label variable cyclistinjured &quot;No. of cyclist injured during that month&quot;
label variable cyclistkilled &quot;No. of cyclist killed during that month&quot;
label variable motoristinjured &quot;No. of motorist injured during that month&quot;
label variable motoristkilled &quot;No. of motorist killed during that month&quot;
label variable collision_count &quot;No. of collisions occured during that month&quot;
label variable flag_collision &quot;At least one collision occurred that month&quot;

label variable latenight_personsinjured &quot;No. of persons injured during that month between 11pm - 5am&quot;
label variable latenight_personskilled &quot;No. of persons killed during that month between 11pm - 5am&quot;
label variable latenight_pedestriansinjured &quot;No. of pedestrians injured during that month between 11pm - 5am&quot;
label variable latenight_pedestrianskilled &quot;No. of pedestrians killed during that month between 11pm - 5am&quot;
label variable latenight_cyclistinjured &quot;No. of cyclist injured during that month between 11pm - 5am&quot;
label variable latenight_cyclistkilled &quot;No. of cyclist killed during that month between 11pm - 5am&quot;
label variable latenight_motoristinjured &quot;No. of motorist injured during that month between 11pm - 5am&quot;
label variable latenight_motoristkilled &quot;No. of motorist killed during that month between 11pm - 5am&quot;
label variable latenight_collision_count &quot;No. of collisions occured during that month between 11pm - 5am&quot;
label variable latenight_flag_collision &quot; At least one collision occurred that month between 11pm - 5am&quot;

label variable day_personsinjured &quot;No. of persons injured during that month between 5am - 11pm&quot;
label variable day_personskilled &quot;No. of persons killed during that month between 5am - 11pm&quot;
label variable day_pedestriansinjured &quot;No. of pedestrians injured during that month between 5am - 11pm&quot;
label variable day_pedestrianskilled &quot;No. of pedestrians killed during that month between 5am - 11pm&quot;
label variable day_cyclistinjured &quot;No. of cyclist injured during that month between 5am - 11pm&quot;
label variable day_cyclistkilled &quot;No. of cyclist killed during that month between 5am - 11pm&quot;
label variable day_motoristinjured &quot;No. of motorist injured during that month between 5am - 11pm&quot;
label variable day_motoristkilled &quot;No. of motorist killed during that month between 5am - 11pm&quot;
label variable day_collision_count &quot;No. of collisions occured during that month between 5am - 11pm&quot;
label variable day_flag_collision &quot; At least one collision occurred that month between 5am - 11pm&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>//save &quot;..\working_data\analytical_file_panel_qt.dta&quot;,replace
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="7.-Convert-analytical-panel-data-into-shapefile">
<h2>7. Convert analytical panel data into shapefile<a class="headerlink" href="#7.-Convert-analytical-panel-data-into-shapefile" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>python</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\analytical_file_panel_qt.dta&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_df = pd.read_stata(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>quarter</th>
      <th>year</th>
      <th>quarterly</th>
      <th>index</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>...</th>
      <th>day_personskilled</th>
      <th>day_pedestriansinjured</th>
      <th>day_pedestrianskilled</th>
      <th>day_cyclistinjured</th>
      <th>day_cyclistkilled</th>
      <th>day_motoristinjured</th>
      <th>day_motoristkilled</th>
      <th>flag_collision</th>
      <th>latenight_flag_collision</th>
      <th>day_flag_collision</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>2</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 163 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_df.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersection_id&#39;, &#39;quarter&#39;, &#39;year&#39;, &#39;quarterly&#39;, &#39;index&#39;, &#39;y&#39;, &#39;x&#39;,
       &#39;st1_name&#39;, &#39;st2_name&#39;, &#39;st3_name&#39;,
       ...
       &#39;day_personskilled&#39;, &#39;day_pedestriansinjured&#39;, &#39;day_pedestrianskilled&#39;,
       &#39;day_cyclistinjured&#39;, &#39;day_cyclistkilled&#39;, &#39;day_motoristinjured&#39;,
       &#39;day_motoristkilled&#39;, &#39;flag_collision&#39;, &#39;latenight_flag_collision&#39;,
       &#39;day_flag_collision&#39;],
      dtype=&#39;object&#39;, length=163)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Put the latitude and longtitude
analytical_df[&#39;geometry&#39;] = list(zip(analytical_df.x, analytical_df.y))
analytical_df[&#39;geometry&#39;] = analytical_df[&#39;geometry&#39;].apply(Point)
analytical_gdf = gpd.GeoDataFrame(analytical_df, geometry=&#39;geometry&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_gdf.crs = {&#39;init&#39; :&#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_gdf.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_336_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_336_0.png" />
</div>
</div>
<p>The shapefile is required to calculate contiguity matrix in Stata</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[397]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span> save_out = analytical_gdf[[&#39;collision_count&#39;,&#39;personsinjured&#39;,&#39;pedestriansinjured&#39;,&#39;cyclistinjured&#39;,&#39;motoristinjured&#39;,
                 &#39;bronx&#39;,&#39;brooklyn&#39;,&#39;manhattan&#39;,&#39;queens&#39;,&#39;statenisland&#39;,&#39;distance_to_LPIS&#39;,&#39;distance_to_Street&#39;,
                 &#39;distance_to_Sch&#39;,&#39;distance_to_LTC&#39;,&#39;distance_to_bikeroute&#39;,&#39;distance_to_truckroute&#39;,
                 &#39;flag_left_turn_ever&#39;,&#39;flag_left_turn&#39;,&#39;flag_LPIS_ever&#39;,&#39;flag_LPIS&#39;,&#39;bike_route_tv&#39;,
                 &#39;bike_route_ever&#39;, &#39;flag_seniors&#39;,&#39;flag_priorityinters&#39;,&#39;flag_school&#39;, &#39;flag_street_improv&#39;,
                 &#39;quarter&#39;,&#39;year&#39;,&#39;intersection_id&#39;,&#39;y&#39;,&#39;x&#39;,&#39;geometry&#39;]]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[398]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp =  r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\analytical_panel_shapefile\analytical_panel_qt_shapefile.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>#save_out.to_file(origin+fp)
</pre></div>
</div>
</div>
</div>
<div class="section" id="8.-Thiessen-Polygons">
<h2>8. Thiessen Polygons<a class="headerlink" href="#8.-Thiessen-Polygons" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>python</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_gdf.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersection_id&#39;, &#39;quarter&#39;, &#39;year&#39;, &#39;quarterly&#39;, &#39;index&#39;, &#39;y&#39;, &#39;x&#39;,
       &#39;st1_name&#39;, &#39;st2_name&#39;, &#39;st3_name&#39;,
       ...
       &#39;day_pedestriansinjured&#39;, &#39;day_pedestrianskilled&#39;, &#39;day_cyclistinjured&#39;,
       &#39;day_cyclistkilled&#39;, &#39;day_motoristinjured&#39;, &#39;day_motoristkilled&#39;,
       &#39;flag_collision&#39;, &#39;latenight_flag_collision&#39;, &#39;day_flag_collision&#39;,
       &#39;geometry&#39;],
      dtype=&#39;object&#39;, length=164)
</pre></div>
</div>
</div>
<p>We want to extract only the cross section of the quarterly panel shapefile</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>analytical_gdf.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>intersection_id</th>
      <th>quarter</th>
      <th>year</th>
      <th>quarterly</th>
      <th>index</th>
      <th>y</th>
      <th>x</th>
      <th>st1_name</th>
      <th>st2_name</th>
      <th>st3_name</th>
      <th>...</th>
      <th>day_pedestriansinjured</th>
      <th>day_pedestrianskilled</th>
      <th>day_cyclistinjured</th>
      <th>day_cyclistkilled</th>
      <th>day_motoristinjured</th>
      <th>day_motoristkilled</th>
      <th>flag_collision</th>
      <th>latenight_flag_collision</th>
      <th>day_flag_collision</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>0</td>
      <td>199793.6093</td>
      <td>986336.1490</td>
      <td>ALLEN STREET</td>
      <td>CANAL STREET</td>
      <td></td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>POINT (986336.149 199793.609300002)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>1</td>
      <td>202206.1619</td>
      <td>982769.3310</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LAIGHT STREET</td>
      <td>CANAL STREET</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POINT (982769.331 202206.161899999)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>2013</td>
      <td>2013-01-01</td>
      <td>2</td>
      <td>201790.0942</td>
      <td>982805.6184</td>
      <td>AVENUE OF THE AMERICAS</td>
      <td>LISPENARD STREET</td>
      <td>WEST BROADWAY</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>POINT (982805.6183999931 201790.0942)</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 164 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Extract cross section of quarter==3 &amp; year == 2012
sub_analytical_gdf = gpd.GeoDataFrame(analytical_gdf.loc[(analytical_gdf[&#39;quarter&#39;] == 3) &amp; (analytical_gdf[&#39;year&#39;] == 2012)])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sub_analytical_gdf[&#39;intersection_id&#39;].count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>12987
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>sub_analytical_gdf.crs = {&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>points = list(zip(sub_analytical_gdf.x,sub_analytical_gdf.y))
</pre></div>
</div>
</div>
<p>Instead of extracting a cross section, we can also collapse the data to the unique intersections level</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collapsed_analytical_gdf = gpd.GeoDataFrame(analytical_gdf.groupby(&#39;intersection_id&#39;).agg({
    &#39;collision_count&#39;: sum, # find the sum of collision_count in each intersection
    &#39;personsinjured&#39;: sum, # find the sum of personsinjured in each intersection
    &#39;pedestriansinjured&#39;: sum, # find the sum of pedestriansinjured in each intersection
    &#39;cyclistinjured&#39;: sum , # find the sum of cyclistinjured in each intersection
    &#39;motoristinjured&#39;: sum , # find the sum of motoristinjured in each intersection
    &#39;flag_LPIS_ever&#39;: &quot;first&quot; ,
    &#39;x&#39;: &quot;first&quot;,
    &#39;y&#39;: &quot;first&quot;,
    &#39;geometry&#39;: &quot;first&quot;})).reset_index()    # find the first geometry
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collapsed_analytical_gdf.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;,
       &#39;flag_LPIS_ever&#39;, &#39;x&#39;, &#39;y&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collapsed_analytical_gdf[&#39;intersection_id&#39;].count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>12987
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collapsed_analytical_gdf.crs = {&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>points = list(zip(collapsed_analytical_gdf.x,collapsed_analytical_gdf.y))
</pre></div>
</div>
</div>
<div class="section" id="8.a.-Voronoi">
<h3>8.a. Voronoi<a class="headerlink" href="#8.a.-Voronoi" title="Permalink to this headline">¶</a></h3>
<p>Creates dataframe regions and vertices</p>
<p>source: <a class="reference external" href="https://github.com/pysal/libpysal/blob/master/notebooks/voronoi.ipynb">https://github.com/pysal/libpysal/blob/master/notebooks/voronoi.ipynb</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>regions, vertices = voronoi_frames(points)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>regions.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;geometry&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>regions.crs = {&#39;init&#39;: &#39;epsg:2263&#39;}
vertices.crs = {&#39;init&#39;: &#39;epsg:2263&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fig, ax = plt.subplots(figsize=(15, 15))
regions.plot(ax=ax, color=&#39;blue&#39;,edgecolor=&#39;black&#39;, alpha=0.3)
vertices.plot(ax=ax, color=&#39;red&#39;);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_360_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_360_0.png" />
</div>
</div>
<p>Problem here is that the voronoi polygons extends far out from NYC’s boundaries. Therefore, we will use <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>’s <code class="docutils literal notranslate"><span class="pre">overlay</span></code> to “cut” the borough shape out.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp = r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\input_data\nyc_boroughs_2263\nyc_boroughs_2263.shp&quot;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf = gpd.read_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf.crs
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;proj&#39;: &#39;lcc&#39;,
 &#39;lat_1&#39;: 41.03333333333333,
 &#39;lat_2&#39;: 40.66666666666666,
 &#39;lat_0&#39;: 40.16666666666666,
 &#39;lon_0&#39;: -74,
 &#39;x_0&#39;: 300000.0000000001,
 &#39;y_0&#39;: 0,
 &#39;datum&#39;: &#39;NAD83&#39;,
 &#39;units&#39;: &#39;us-ft&#39;,
 &#39;no_defs&#39;: True}
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf = borough_gdf.to_crs({&#39;init&#39;: &#39;epsg:2263&#39;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_gdf.count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>bcode       5
bname       5
name        5
namelsad    5
geometry    5
dtype: int64
</pre></div>
</div>
</div>
<p>There are multipolygons in each boroughs, but we want each polygon to be on its own. Therefore, we will use <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>’s <code class="docutils literal notranslate"><span class="pre">explode</span></code> function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_explode_gdf = borough_gdf.explode()
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>borough_explode_gdf.count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>bcode       85
bname       85
name        85
namelsad    85
geometry    85
dtype: int64
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span># Overlay with borough to extract the outlines
voronoi_sub_analytical_gdf = gpd.overlay(regions, borough_explode_gdf, how=&#39;intersection&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_sub_analytical_gdf.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_371_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_371_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_sub_analytical_gdf.count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>bcode       13315
bname       13315
name        13315
namelsad    13315
geometry    13315
dtype: int64
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_sub_analytical_gdf.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;bcode&#39;, &#39;bname&#39;, &#39;name&#39;, &#39;namelsad&#39;, &#39;geometry&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collapsed_analytical_gdf.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;,
       &#39;flag_LPIS_ever&#39;, &#39;x&#39;, &#39;y&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<p>Problem: Recall that there were only 12987 counts previously, but now there is 13315. We will use <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>’s <code class="docutils literal notranslate"><span class="pre">sjoin</span></code> to find polygons that intersect with the signal intersection points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_intersections_collapsed_analytical_gdf = gpd.sjoin(voronoi_sub_analytical_gdf,collapsed_analytical_gdf, how=&#39;inner&#39;, op=&#39;intersects&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_intersections_collapsed_analytical_gdf.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bcode</th>
      <th>bname</th>
      <th>name</th>
      <th>namelsad</th>
      <th>geometry</th>
      <th>index_right</th>
      <th>intersection_id</th>
      <th>collision_count</th>
      <th>personsinjured</th>
      <th>pedestriansinjured</th>
      <th>cyclistinjured</th>
      <th>motoristinjured</th>
      <th>flag_LPIS_ever</th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>POLYGON ((986291.1955668803 200052.298871208, ...</td>
      <td>0</td>
      <td>1</td>
      <td>97.0</td>
      <td>21.0</td>
      <td>7</td>
      <td>3</td>
      <td>11.0</td>
      <td>0</td>
      <td>986336.1490</td>
      <td>199793.6093</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>POLYGON ((982721.8764644475 202448.3499543682,...</td>
      <td>1</td>
      <td>2</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>0</td>
      <td>0</td>
      <td>1.0</td>
      <td>0</td>
      <td>982769.3310</td>
      <td>202206.1619</td>
    </tr>
    <tr>
      <th>5</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>POLYGON ((983012.7139141727 201750.4648247989,...</td>
      <td>2</td>
      <td>3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>0</td>
      <td>982805.6184</td>
      <td>201790.0942</td>
    </tr>
    <tr>
      <th>7</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>POLYGON ((982967.8732795889 201664.0831515846,...</td>
      <td>3</td>
      <td>4</td>
      <td>50.0</td>
      <td>5.0</td>
      <td>3</td>
      <td>1</td>
      <td>1.0</td>
      <td>0</td>
      <td>982812.2555</td>
      <td>201529.9618</td>
    </tr>
    <tr>
      <th>9</th>
      <td>36061</td>
      <td>Manhattan</td>
      <td>New York</td>
      <td>New York County</td>
      <td>POLYGON ((982619.6644923392 201201.7787439331,...</td>
      <td>4</td>
      <td>5</td>
      <td>45.0</td>
      <td>10.0</td>
      <td>1</td>
      <td>2</td>
      <td>7.0</td>
      <td>0</td>
      <td>982816.3956</td>
      <td>201226.1097</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_sub_analytical_gdf[&#39;bcode&#39;].count()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>13315
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>print(voronoi_intersections_collapsed_analytical_gdf.columns.values)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;bcode&#39; &#39;bname&#39; &#39;name&#39; &#39;namelsad&#39; &#39;geometry&#39; &#39;index_right&#39;
 &#39;intersection_id&#39; &#39;collision_count&#39; &#39;personsinjured&#39; &#39;pedestriansinjured&#39;
 &#39;cyclistinjured&#39; &#39;motoristinjured&#39; &#39;flag_LPIS_ever&#39; &#39;x&#39; &#39;y&#39;]
</pre></div></div>
</div>
<p>It is suppose to be 12,987, but we only have 12983. The 4 intersections were lost because they are outside the boundaries of the boroughs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_intersections_collapsed_analytical_gdf.plot(figsize=(15, 15));
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_381_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_381_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[84]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>quantiles = ps.Quantiles(voronoi_intersections_collapsed_analytical_gdf[&#39;collision_count&#39;], k=4)
f, ax = plt.subplots(1, figsize=(25, 18))
voronoi_intersections_collapsed_analytical_gdf.assign(cl=quantiles.yb).plot(column=&#39;cl&#39;, categorical=True, \
        k=4, cmap=&#39;OrRd&#39;, linewidth=0.1, ax=ax, \
        edgecolor=&#39;black&#39;, legend=True)
ax.set_axis_off()
plt.title(&quot;Total Number of Collisions by Quartiles&quot;)
plt.savefig(&#39;../manuscripts/NYC_collisions_quartiles.pdf&#39;, bbox_inches=&#39;tight&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_382_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_382_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[85]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>quantiles10 = ps.Quantiles(voronoi_intersections_collapsed_analytical_gdf[&#39;collision_count&#39;], k=10)
f, ax = plt.subplots(1, figsize=(25, 18))
voronoi_intersections_collapsed_analytical_gdf.assign(cl=quantiles10.yb).plot(column=&#39;cl&#39;, categorical=True, \
        k=10, cmap=&#39;OrRd&#39;, linewidth=0.1, ax=ax, \
        edgecolor=&#39;black&#39;, legend=True)
ax.set_axis_off()
plt.title(&quot;Total Number of Collisions by Deciles&quot;)
plt.savefig(&#39;../manuscripts/NYC_collisions_deciles.pdf&#39;, bbox_inches=&#39;tight&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_383_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_383_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>quantiles = ps.Quantiles(voronoi_intersections_collapsed_analytical_gdf[&#39;flag_LPIS_ever&#39;], k=2)
f, ax = plt.subplots(1, figsize=(25, 18))
voronoi_intersections_collapsed_analytical_gdf.assign(cl=quantiles.yb).plot(column=&#39;cl&#39;, categorical=True, \
        k=4, cmap=&#39;BuPu&#39;, linewidth=0.1, ax=ax, \
        edgecolor=&#39;black&#39;, legend=True)
ax.set_axis_off()
plt.title(&quot;Leading Pedestrian Intervanl Signals&quot;)
plt.show();
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_384_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_384_0.png" />
</div>
</div>
</div>
<div class="section" id="8.b.-Spatial-Autocorrelation">
<h3>8.b. Spatial Autocorrelation<a class="headerlink" href="#8.b.-Spatial-Autocorrelation" title="Permalink to this headline">¶</a></h3>
<p>“The concept of spatial autocorrelation relates to the combination of two types of similarity: spatial similarity and attribute similarity. Although there are many different measures of spatial autocorrelation, they all combine these two types of simmilarity into a summary measure.” source: <a class="reference external" href="http://darribas.org/gds_scipy16/ipynb_md/04_esda.html">http://darribas.org/gds_scipy16/ipynb_md/04_esda.html</a></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>voronoi_intersections_collapsed_analytical_gdf.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;bcode&#39;, &#39;bname&#39;, &#39;name&#39;, &#39;namelsad&#39;, &#39;geometry&#39;, &#39;index_right&#39;,
       &#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;,
       &#39;flag_LPIS_ever&#39;, &#39;x&#39;, &#39;y&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span> save_out = voronoi_intersections_collapsed_analytical_gdf[[&#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;, &#39;y&#39;, &#39;x&#39;,
       &#39;geometry&#39;]]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>fp =  r&quot;C:\Users\jerem\Box Sync\Policy Evaluation\working_data\analytical_panel_shapefile\collapsed_analytical_panel_qt_shapefile.shp&quot;

save_out.to_file(fp)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>data = ps.pdio.read_files(fp)
W = ps.queen_from_shapefile(fp)
W.transform = &#39;r&#39;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>data.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersecti&#39;, &#39;collision_&#39;, &#39;personsinj&#39;, &#39;pedestrian&#39;, &#39;cyclistinj&#39;,
       &#39;motoristin&#39;, &#39;y&#39;, &#39;x&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>data.columns = ([&#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;, &#39;y&#39;, &#39;x&#39;,
       &#39;geometry&#39;])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>data.columns
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;intersection_id&#39;, &#39;collision_count&#39;, &#39;personsinjured&#39;,
       &#39;pedestriansinjured&#39;, &#39;cyclistinjured&#39;, &#39;motoristinjured&#39;, &#39;y&#39;, &#39;x&#39;,
       &#39;geometry&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_count_Lag = ps.lag_spatial(W, data[&#39;collision_count&#39;])
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>collision_count_LagQ4 = ps.Quantiles(collision_count_Lag, k=4)
collision_count_LagQ10 = ps.Quantiles(collision_count_Lag, k=10)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>f, ax = plt.subplots(1, figsize=(25, 18))
voronoi_intersections_collapsed_analytical_gdf.assign(cl=collision_count_LagQ4.yb).plot(column=&#39;cl&#39;, categorical=True, \
        k=4, cmap=&#39;OrRd&#39;, linewidth=0.1, ax=ax, \
        edgecolor=&#39;black&#39;, legend=True)
ax.set_axis_off()
plt.title(&quot;Collisions Spatial Lag Quartiles&quot;)
plt.savefig(&#39;../manuscripts/NYC_collisions_quartiles_lagged.pdf&#39;, bbox_inches=&#39;tight&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_396_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_396_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-sos notranslate"><div class="highlight"><pre>
<span></span>f, ax = plt.subplots(1, figsize=(25, 18))
voronoi_intersections_collapsed_analytical_gdf.assign(cl=collision_count_LagQ10.yb).plot(column=&#39;cl&#39;, categorical=True, \
        k=10, cmap=&#39;OrRd&#39;, linewidth=0.1, ax=ax, \
        edgecolor=&#39;black&#39;, legend=True)
ax.set_axis_off()
plt.title(&quot;Collisions Spatial Lag Deciles&quot;)
plt.savefig(&#39;../manuscripts/NYC_collisions_deciles_lagged.pdf&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_397_0.png" src="_images/Impact-Evaluation-of-Leading-Pedestrian-Interval-Signals_397_0.png" />
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="stata_analysis_qt_panel.html" class="btn btn-neutral float-right" title="Stata Analysis of NYC Leading Pedestrian Interval Signal (LPIs)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Jeremy J. Sze’s Masters Thesis Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jeremy J. Sze

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>